import{u as V,_,c as y,r as b,l as S}from"./userStore-77faf1db.js";import{p as D,r as c,a as U,o as h,c as C,b as u,d as i,w as m,u as a,E as f,e as p,f as R,g as F,t as v,h as B,i as g,s as x}from"./index-94592c9f.js";const $={class:"login"},I={class:"login-box"},M=u("div",{class:"login-box-avatar"},[u("img",{src:_})],-1),J={__name:"login",setup(j){sessionStorage.clear();const w=V(D);let o=c({changeName:"注册",confirmName:"登录",isRegister:!1}),d=U(null);const k=()=>{d.value.resetFields()},E=()=>{o.changeName=="注册"?(o.isRegister=!0,o.changeName="登录",o.confirmName="注册"):(o.isRegister=!1,o.changeName="注册",o.confirmName="登录"),r.username="",r.password="",r.checkPassword="",k()};let r=c({username:"",password:"",checkPassword:""}),N=c({username:[{min:3,max:10,message:"用户名长度应在 3-10 个字符",trigger:"blur"},{validator:async(n,s,e)=>{if(s==="")e(new Error("请输入用户名"));else{let l=await y(r.username);if(o.confirmName==="注册"){let t=l.data;t.status?e(new Error(t.msg)):e()}else l.data.status?e():e("该用户名不存在！")}},trigger:"blur"}],password:[{min:6,max:15,message:"密码长度应在 6-15 个字符",trigger:"blur"},{validator:(n,s,e)=>{s===""?e(new Error("请输入密码")):(r.checkPassword!==""&&d.value.validateField("checkPassword"),e())},trigger:"blur"}],checkPassword:[{validator:(n,s,e)=>{s===""?e(new Error("请再次输入密码")):s!==r.password?e(new Error("两次输入密码不一致!")):e()},trigger:"blur"}]});const P=n=>{d.value.validate(async s=>{if(!s)return;let e=!1,l=null;if(o.confirmName==="注册"?l=await b(r.username,r.password):l=await S(r.username,r.password),l){let t=l.data;t.status?g.error(t.msg):(g.success(t.msg),e=!0),e&&(w.username=t.username,w.token=t.token,x("token",t.token),x("username",t.username),n.push("/home"))}else g.success(o.confirmName+"异常，请重试！")})};return(n,s)=>(h(),C("div",$,[u("div",I,[M,i(a(B),{ref_key:"formRef",ref:d,model:a(r),rules:a(N),"label-width":"100px",class:"login-box-form",autocomplete:"off"},{default:m(()=>[i(a(f),{label:"用  户  名：",prop:"username"},{default:m(()=>[i(a(p),{placeholder:"请输入用户名",modelValue:a(r).username,"onUpdate:modelValue":s[0]||(s[0]=e=>a(r).username=e),"input-style":"height:35px;",autocomplete:"off"},null,8,["modelValue"])]),_:1}),i(a(f),{label:"密       码：",prop:"password"},{default:m(()=>[i(a(p),{placeholder:"请输入密码",modelValue:a(r).password,"onUpdate:modelValue":s[1]||(s[1]=e=>a(r).password=e),"input-style":"height:35px;","show-password":"",type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(o).isRegister?(h(),R(a(f),{key:0,label:"确认密码：",prop:"checkPassword"},{default:m(()=>[i(a(p),{placeholder:"请再次输入密码",modelValue:a(r).checkPassword,"onUpdate:modelValue":s[2]||(s[2]=e=>a(r).checkPassword=e),"input-style":"height:35px;","show-password":"",type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1})):F("",!0),i(a(f),{class:"login-box-form-btns"},{default:m(()=>[u("button",{class:"confirm",onClick:s[3]||(s[3]=e=>P(n.$router))}," 立即"+v(a(o).confirmName),1),u("div",{class:"change",onClick:s[4]||(s[4]=e=>E())}," 去"+v(a(o).changeName),1)]),_:1})]),_:1},8,["model","rules"])])]))}};export{J as default};
