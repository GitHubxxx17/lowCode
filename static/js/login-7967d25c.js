import{_}from"./user-339da0c7.js";import{s as x}from"./index-765abcf3.js";import{d as y,p as E,r as g,a as S,o as v,c as C,b as m,e as t,w as u,u as e,E as f,f as w,g as R,h as F,t as k,i as B,j as h,s as D}from"./index-edd6c2d0.js";function $(d,l){return x({method:"post",url:"/user/reguser",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{username:d,password:l}})}function U(d,l){return x({method:"post",url:"/user/login",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{username:d,password:l}})}const I=y("userStore",{state:()=>({username:"",token:""})}),M={class:"login"},T={class:"login-box"},j=m("div",{class:"login-box-avatar"},[m("img",{src:_})],-1),J={__name:"login",setup(d){sessionStorage.clear();const l=I(E);let o=g({changeName:"注册",confirmName:"登录",isRegister:!1}),c=S(null);const N=()=>{c.value.resetFields()},b=()=>{o.changeName=="注册"?(o.isRegister=!0,o.changeName="登录",o.confirmName="注册"):(o.isRegister=!1,o.changeName="注册",o.confirmName="登录"),r.username="",r.password="",r.checkPassword="",N()};let r=g({username:"admin",password:"123456",checkPassword:""}),P=g({username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:10,message:"用户名长度应在 3-10 个字符",trigger:"blur"}],password:[{min:6,max:15,message:"密码长度应在 6-15 个字符",trigger:"blur"},{validator:(i,s,a)=>{s===""?a(new Error("请输入密码")):(r.checkPassword!==""&&c.value.validateField("checkPassword"),a())},trigger:"blur"}],checkPassword:[{validator:(i,s,a)=>{s===""?a(new Error("请再次输入密码")):s!==r.password?a(new Error("两次输入密码不一致!")):a()},trigger:"blur"}]});const V=i=>{c.value.validate(async s=>{if(!s)return;let a=!1,p=null;if(o.confirmName==="注册"?p=await $(r.username,r.password):p=await U(r.username,r.password),p){let n=p.data;n.status?h.error(n.msg):(h.success(n.msg),a=!0),a&&(l.username=n.username,l.token=n.token,D("token",n.token),i.push("/home"))}else h.success(o.confirmName+"异常，请重试！")})};return(i,s)=>(v(),C("div",M,[m("div",T,[j,t(e(B),{ref_key:"formRef",ref:c,model:e(r),rules:e(P),"label-width":"100px",class:"login-box-form",autocomplete:"off"},{default:u(()=>[t(e(f),{label:"用  户  名：",prop:"username"},{default:u(()=>[t(e(w),{placeholder:"请输入用户名",modelValue:e(r).username,"onUpdate:modelValue":s[0]||(s[0]=a=>e(r).username=a),"input-style":"height:35px;",autocomplete:"off"},null,8,["modelValue"])]),_:1}),t(e(f),{label:"密       码：",prop:"password"},{default:u(()=>[t(e(w),{placeholder:"请输入密码",modelValue:e(r).password,"onUpdate:modelValue":s[1]||(s[1]=a=>e(r).password=a),"input-style":"height:35px;","show-password":"",type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(o).isRegister?(v(),R(e(f),{key:0,label:"确认密码：",prop:"checkPassword"},{default:u(()=>[t(e(w),{placeholder:"请再次输入密码",modelValue:e(r).checkPassword,"onUpdate:modelValue":s[2]||(s[2]=a=>e(r).checkPassword=a),"input-style":"height:35px;","show-password":"",type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1})):F("",!0),t(e(f),{class:"login-box-form-btns"},{default:u(()=>[m("button",{class:"confirm",onClick:s[3]||(s[3]=a=>V(i.$router))}," 立即"+k(e(o).confirmName),1),m("div",{class:"change",onClick:s[4]||(s[4]=a=>b())}," 去"+k(e(o).changeName),1)]),_:1})]),_:1},8,["model","rules"])])]))}};export{J as default};
