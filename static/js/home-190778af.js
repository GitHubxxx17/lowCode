import{bQ as ie,p as V,bu as se,aS as $,X as P,a as _,aE as re,d as t,e as E,aV as F,bR as ce,F as ee,bN as de,r as T,o as ue,f as fe,w as h,u as c,h as W,E as I,b as X,i as U,s as H,bP as Y,Q as O,bS as G}from"./index-9b1bbba9.js";import{m as te,s as D,u as me,c as pe,_ as ye}from"./userStore-3a7a7dff.js";const he="page",ge="Hello world",ve={},be=[{type:"container-ordinary",style:{position:"relative",width:"100%",zIndex:1},children:[{type:"button",style:{display:"",position:"relative",zIndex:1},buttonstyle:"primary",size:"default",icon:{},twiceComfire:{},bubblePrompt:{triggerMode:"鼠标悬浮",promptLocation:"下"},isDisable:!1,children:"我的按钮"},{type:"text",style:{position:"relative",fontSize:"20px",color:"blue",zIndex:1},children:"(｡･∀･)ﾉﾞ"},{type:"input",value:"",inputStyle:"text",size:"default",defaultValue:"123",placeholder:"",showPassword:!1,maxlength:0,minlength:0,showWordLimit:!0,style:{position:"relative",zIndex:1},children:""}]}],je={type:he,title:ge,style:ve,body:be},we=ie("dragStore",{state:()=>({selectedMaterial:null,isClone:!1,isDrag:!1,isDraging:!1,selectKey:null,selectParent:null,selectedComponent:null,containerData:null,selectedIndex:null,dragEl:null}),actions:{destructionOfDrag:null}});function xe(e){return{all:e=e||new Map,on:function(l,i){var n=e.get(l);n?n.push(i):e.set(l,[i])},off:function(l,i){var n=e.get(l);n&&(i?n.splice(n.indexOf(i)>>>0,1):e.set(l,[]))},emit:function(l,i){var n=e.get(l);n&&n.slice().map(function(a){a(i)}),(n=e.get("*"))&&n.slice().map(function(a){a(l,i)})}}}const Q=xe();function Ee(){const e=we(V);let l=te(V),i=null,n=null,a=null,b=0,x=0,y=-1,g=-1,d=[],M=!1;se(()=>e.dragEl,(o,r)=>{r&&r.classList.remove("chosenEl"),o==null||o.classList.add("chosenEl"),n&&n.classList.remove("chosen-container"),n=o!=null&&o.parentNode?p(o.parentNode):n,n&&n.classList.add("chosen-container")});const R=()=>{n==null||n.classList.remove("chosen-container"),i&&i.remove(),a&&a.remove(),i=null,a=null,n=null,e.isClone=!1,e.isDrag=!1,e.isDraging=!1,d=[],document.body.removeEventListener("mousemove",j),document.body.removeEventListener("mousemove",N)},z=(o,r)=>{k(r);const w=s(r.target);Q.emit("cloneStart"),e.isClone=!0,e.selectedMaterial=o,K("ghostClone",w,r),document.body.addEventListener("mousemove",j)},k=o=>{if(!(!m(o.target)&&!e.isClone)){if(e.isClone&&(n&&(e.selectParent=n.attributes["data-id"].nodeValue),l.isNeedSave=!0,console.log("needSave1"),Q.emit("cloneEnd"),e.selectedMaterial=null),e.isDrag){if(e.dragEl){if(e.dragEl.style.removeProperty("visibility"),document.body.removeEventListener("mousemove",N),M){Array.from(n.children).forEach(C=>{C.style.removeProperty("transform"),C.style.removeProperty("transition")});let r=l.EditorDataMap.get(e.selectKey).parent,w=l.EditorDataMap.get(r).children;w.splice(y,1),w.splice(g,0,e.selectKey),M=!1}e.dragEl.classList.remove("chosenEl"),e.dragEl.onmousedown=null}e.isDraging=!1,e.dragEl=null,l.isNeedSave=!0,console.log("needSave2")}R()}};document.body.onmouseup=k;const v=o=>{e.isClone&&(n&&(n.classList.remove("chosen-container"),a&&n.removeChild(a)),n=p(o.target),n.classList.add("chosen-container"),a=document.createElement("div"),a.classList.add("renderEl"),n.appendChild(($(e.selectedMaterial.render(e.selectedMaterial.defaultData),a),a)))},u=o=>{if(e.isClone){n&&n.classList.remove("chosen-container");let r=p(o.target);n.removeChild(a),n==r&&(n=p(o.target.parentNode),n.classList.add("chosen-container"),a=document.createElement("div"),a.classList.add("renderEl"),n.appendChild(($(e.selectedMaterial.render(e.selectedMaterial.defaultData),a),a)))}},s=o=>o.tagName=="DIV"?o.children[0]:o.tagName=="SPAN"?o:s(o.parentNode),p=o=>o.className.includes("container")||o.className.includes("Editorcontainer")?o:p(o.parentNode),m=o=>o.parentNode==document.body?!1:o!=null&&o.classList.contains("Editorcontainer")?!0:m(o.parentNode),ne=o=>{if(o.target.classList.contains("Editorcontainer")){n=o.target,o.target.classList.add("chosen-container"),e.selectKey=null;return}e.dragEl=A(o.target),n=p(e.dragEl.parentNode),e.dragEl.classList.add("chosenEl"),n.classList.add("chosen-container"),g=y=[].indexOf.call(n.children,e.dragEl),oe(),e.isDrag=!0,e.selectKey=e.dragEl.attributes["data-id"].nodeValue,e.dragEl.onmousedown=r=>{console.log("正在交换组件中"),e.isDraging=!0,K("ghostDrag",e.dragEl,r),document.body.addEventListener("mousemove",N)},e.destructionOfDrag=()=>{e.isDrag&&(e.selectKey=null,i&&i.remove(),e.dragEl&&(e.dragEl.style.removeProperty("visibility"),document.body.removeEventListener("mousemove",N),n==null||n.classList.remove("chosen-container"),e.dragEl.classList.remove("chosenEl"),e.dragEl.onmousedown=null),e.isDraging=!1,e.isDrag=!1,e.dragEl=null)}},N=o=>{j(o),M=!0;for(let r=0;r<d.length;r++)if(r!==g&&o.clientX>d[r].left&&o.clientX<d[r].right&&o.clientY>d[r].top&&o.clientY<d[r].bottom){if(g<r)for(let f=g;f<r;f++)if(f<y)n.children[f].style.transform="translate3d(0px, 0px, 0)";else{const L=d[f].left-d[f+1].left,S=d[f].top-d[f+1].top;n.children[f+1].style.transform="translate3d("+L+"px, "+S+"px, 0)"}else if(g>r)for(let f=r;f<g;f++)if(y<=f)n.children[f+1].style.transform="translate3d(0px, 0px, 0)";else{const L=d[f+1].left-d[f].left,S=d[f+1].top-d[f].top;n.children[f].style.transform="translate3d("+L+"px, "+S+"px, 0)"}const w=d[r].left-d[y].left,C=d[r].top-d[y].top;e.dragEl.style.transform="translate3d("+w+"px, "+C+"px, 0)",g=r;break}},oe=()=>{d=[];for(let o of n.children)o.style.setProperty("transition","transform 300ms ease"),d.push(o.getBoundingClientRect())},A=o=>o?o.className&&o.className.includes("container")||o.classList&&o.classList.contains("cannotPreview")?o:A(o.parentNode):null,K=(o,r,w)=>{const{clientY:C,clientX:f}=w,{top:L,left:S,width:le,height:ae}=r.getBoundingClientRect();b=f-S,x=C-L,i=document.createElement("div"),i.classList.add(o),i.style.width=`${le}px`,i.style.height=`${ae}px`,i.innerHTML=r.outerHTML,document.body.appendChild(i),i.style.top=`${L}px`,i.style.left=`${S}px`},j=({clientY:o,clientX:r})=>{i.style.top=`${o-x}px`,i.style.left=`${r-b}px`};return{cloneMousedown:z,mouseenter:v,mouseleave:u,onclickToDrag:ne,deterWhetherToMoveUp:o=>o()}}const q=Ee();const J=P({props:{style:Object,children:Object,childrenList:Array,text:String,class:String},setup(e){let l=_(null);return re(()=>{l.value.attributes.childrenList=e.childrenList}),()=>t("div",{class:e.class,style:e.style,ref:l,datatype:e.class,onMouseenter:i=>q.mouseenter(i),onMouseleave:i=>q.mouseleave(i)},[e.children.length!=0?e.children:t("span",{class:"nochild"},[e.text])])}}),Pe=P({props:{option:{type:Object}},setup(e){return()=>t(E,{modelValue:e.option.value,"onUpdate:modelValue":l=>e.option.value=l,style:e.option.style,size:e.option.size,type:e.option.inputStyle,placeholder:e.option.placeholder,showPassword:e.option.showPassword,clearable:e.option.clearable,"show-word-limit":e.option.showWordLimit,disabled:e.option.disabled,readonly:e.option.readonly,autofocus:e.option.autofocus,maxlength:e.option.maxlength,minlength:e.option.minlength},null)}}),De=P({props:{option:{type:Object}},setup(e){return()=>t(ce,{style:e.option.style,filterable:e.option.filterable?e.option.filterable:!1,placeholder:e.option.placeholder?e.option.placeholder:"请选择",modelValue:e.option.defaultValue,"onUpdate:modelValue":l=>e.option.defaultValue=l},{default:()=>[e.option.selectData&&e.option.selectData.map(l=>t(F("el-option"),{key:l.value,value:l.value},null))]})}}),Ce=P({props:{option:{type:Object}},setup(e){return()=>t(ee,null,[t("div",{style:e.option.style.title},[e.option.title?e.option.title:"文本"]),t(E,{modelValue:e.option.value,"onUpdate:modelValue":l=>e.option.value=l,style:e.option.style.input,placeholder:e.option.inputBoxPlaceholder?e.option.inputBoxPlaceholder:"",clearable:e.option.clearable?e.option.clearable:!1,type:e.option.inputType?e.option.inputType:"text"},null)])}}),Le=P({props:{option:{type:Object}},setup(e){return()=>t(ee,null,[t("div",{style:e.option.style.title},[e.option.title?e.option.title:"多行文本"]),t(E,{modelValue:e.option.value,"onUpdate:modelValue":l=>e.option.value=l,style:e.option.style.input,type:"textarea",placeholder:e.option.inputBoxPlaceholder?e.option.inputBoxPlaceholder:"",clearable:e.option.clearable?e.option.clearable:!1,rows:e.option.autosize.minRows},null)])}}),Se=[{label:"用户",icon:"icon iconfont icon-yonghu"},{label:"退出",icon:"icon iconfont icon-h"},{label:"叉 关闭",icon:"icon iconfont icon-cha"},{label:"叉 关闭",icon:"icon iconfont icon-cha1"},{label:"连接",icon:"icon iconfont icon-ai70"},{label:"密码",icon:"icon iconfont icon-mima"},{label:"返回 左箭头",icon:"icon iconfont icon-fanhui"},{label:"搜索",icon:"icon iconfont icon-search"},{label:"笑脸",icon:"icon iconfont icon-xiaolian"},{label:"菜单",icon:"icon iconfont icon-caidan"},{label:"修改",icon:"icon iconfont icon-xiugai"}],Ie=[{label:"容器",icon:"icon iconfont icon-checkbox",type:"container-ordinary",category:"container",render(e){return e={...e,text:"容器",class:"container-ordinary","data-id":e.id},t(J,e,null)},defaultData:{type:"container-ordinary",style:{position:"relative",width:"100%",zIndex:1},children:[]}},{label:"自由容器",icon:"icon iconfont icon-zidingyibuju",type:"container-free",category:"container",render(e){return e={...e,text:"自由容器",class:"container-free","data-id":e.id},t(J,e,null)},defaultData:{type:"container-free",style:{position:"relative",width:"100%",zIndex:1},children:[]}},{label:"文字",icon:"icon iconfont icon-font",type:"text",category:"common",render(e){return t("div",{class:"cannotPreview","data-id":e.id},[t("span",{style:e.style,datatype:"text"},[e.children?e.children:"渲染文字"])])},defaultData:{type:"text",style:{position:"relative",fontSize:"16px",color:"black",zIndex:1},children:"渲染文字"}},{label:"按钮",icon:"icon iconfont icon-anniu",type:"button",category:"common",render(e){return t("div",{class:"cannotPreview","data-id":e.id},[t(de,{style:e.style,class:"baseButton",type:e.buttonstyle,size:e.size,disabled:e.isDisable},{default:()=>[t("i",{class:["icon iconfont leftIcon",e.icon.leftIcon],style:{"font-size":e.icon.leftIconSize}},null),e.children?e.children:"渲染按钮",t("i",{class:["icon iconfont rightIcon",e.icon.rightIcon],style:{"font-size":e.icon.rightIconSize}},null)]})])},defaultData:{type:"button",style:{position:"relative",width:"87px",height:"32px",zIndex:1},buttonstyle:"",size:"default",icon:{},twiceComfire:{},bubblePrompt:{},isDisable:!0,children:"渲染按钮"}},{label:"输入框",icon:"icon iconfont icon-input",type:"input",category:"common",render(e){return t("div",{class:"cannotPreview","data-id":e.id},[t(Pe,{option:e},null)])},defaultData:{type:"input",value:"",inputStyle:"text",size:"default",placeholder:"请输入",showPassword:!1,clearable:!1,showWordLimit:!1,disabled:!1,readonly:!1,autofocus:!1,style:{position:"relative",zIndex:1},children:""}},{label:"下拉框",icon:"icon iconfont icon-m-xialacaidan",type:"select",category:"common",render(e){return t("div",{class:"cannotPreview","data-id":e.id},[t(De,{option:e},null)])},defaultData:{type:"select",style:{position:"relative",zIndex:1},children:"",defaultValue:""}},{label:"文本框",icon:"icon iconfont icon-wenben",type:"textBox",category:"form",render(e){return t("div",{class:"cannotPreview",style:e.style.box,"data-id":e.id},[t(Ce,{option:e},null)])},defaultData:{value:"",type:"textBox",title:"文本",style:{box:{display:"block"},title:{},input:{}},children:""}},{label:"多行文本框",icon:"icon iconfont icon-duohangwenben1",type:"multilineText",category:"form",render(e){return t("div",{class:"cannotPreview",style:e.style.box,"data-id":e.id},[t(Le,{option:e},null)])},defaultData:{value:"",type:"multilineText",title:"多行文本",style:{box:{display:"block"},title:{},input:{}},children:"",autosize:{minRows:2,maxRows:6}}}];class Me{constructor(l=[],i=new Map,n=[]){this.componentList=l,this.componentMap=i,this.iconList=n}register(l,i=!1){i?this.iconList.push(l):this.componentList.push(l),this.componentMap.set(l.type,l)}}const B=new Me;for(let e of Ie)B.register({label:e.label,type:e.type,category:e.category,defaultData:e.defaultData,display:!0,preview:()=>t(ze,{block:e}),render:l=>e.render(l)});for(let e of Se)B.register({label:e.label,type:"icon",category:"icon",display:!0,defaultData:{icon:e.icon,type:"icon",style:{position:"relative",fontSize:"16px",color:"black",zIndex:1},children:""},preview:()=>t("span",{datatype:"icon",class:"iconSpan"},[t("i",{class:e.icon},null)]),render:l=>t("div",{class:"cannotPreview","data-id":l.id},[t("i",{class:l.icon,style:l.style},null)])},!0);const ze=P({props:{block:{type:Object}},setup(e){return()=>t("span",{datatype:e.block.type},[t("i",{class:e.block.icon},null),t("label",null,[e.block.label])])}});let Z=te(V);const ke=e=>e instanceof Array?e.map(l=>{let i=ke(l.children),n=T({...l,children:i,style:l.style});return l.type.includes("container")&&(n.childrenList=l.children),B.componentMap.get(l.type).render(n)}):e,Ne=e=>{let l=Z.EditorDataMap.get(e);if(l.children instanceof Array)return l.children.map(i=>{var x;let n=Ne(i),a=Z.EditorDataMap.get(i),b=T({...a,id:i,style:a.style});return a.type.includes("container")&&(b.children=n,b.childrenList=a.children),(x=B.componentMap.get(a.type))==null?void 0:x.render(b)})};function Ue(e){return D({method:"post",url:"/modfiyUserInfo/modifyUsername",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{username:e}})}function Ve(e){return D({method:"post",url:"/modfiyUserInfo/checkPassword",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{password:e}})}function _e(e){return D({method:"post",url:"/modfiyUserInfo/modifyPassword",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{password:e}})}const Fe={__name:"settingPages",props:["modifyForm"],setup(e){const l=e,i=me(V);let n=_(null),a=T({username:"",oldPassword:"",newPassword:"",checkPassword:""});const b=async(v,u,s)=>{if(u==="")s(new Error("请新的输入用户名"));else{let m=(await pe(a.username)).data;m.status?s(new Error(m.msg)):s()}},x=()=>{n.value.validate(async v=>{if(!v)return;let s=(await Ue(a.username)).data;s.status?U.error(s.msg):(U.success(s.msg),i.username=s.username,H("username",s.username),a.username="",l.modifyForm.value=!1,a.username="")})};let y=_(null);const g=async(v,u,s)=>{if(u==="")s(new Error("请输入原始密码"));else{if(a.oldPassword!==""){let p=await Ve(a.oldPassword);console.log(p);let m=p.data;m.status?s(new Error(m.msg)):s()}s()}},d=(v,u,s)=>{u===""?s(new Error("请输入密码")):(a.checkPassword!==""&&y.value.validateField("checkPassword"),s())},M=(v,u,s)=>{u===""?s(new Error("请再次输入密码")):u!==a.newPassword?s(new Error("两次输入密码不一致!")):s()},R=()=>{y.value.validate(async v=>{if(!v)return;let s=(await _e(a.newPassword)).data;s.status?U.error(s.msg):(U.success(s.msg),i.password=s.password,H("password",s.password),l.modifyForm.value=!1,a.oldPassword="",a.newPassword="",a.checkPassword="")})};let z=T({username:[{min:3,max:10,message:"用户名长度应在 3-10 个字符",trigger:"blur"},{validator:b,trigger:"blur"}],oldPassword:[{validator:g,trigger:"blur"}],newPassword:[{min:6,max:15,message:"密码长度应在 6-15 个字符",trigger:"blur"},{validator:d,trigger:"blur"}],checkPassword:[{validator:M,trigger:"blur"}]});const k=()=>{y.value.resetFields(),n.value.resetFields()};return(v,u)=>{const s=F("el-tab-pane"),p=F("el-tabs");return ue(),fe(p,{type:"border-card","tab-position":"left",class:"card",onTabClick:k},{default:h(()=>[t(s,{label:"修改用户名"},{default:h(()=>[t(c(W),{ref_key:"usernameFormRef",ref:n,model:c(a),rules:c(z),"label-width":"100px",autocomplete:"off"},{default:h(()=>[t(c(I),{label:"用户名：",prop:"username",class:"formItemCommon"},{default:h(()=>[t(c(E),{placeholder:"请输入新的用户名",modelValue:c(a).username,"onUpdate:modelValue":u[0]||(u[0]=m=>c(a).username=m),"input-style":"height:35px;",autocomplete:"off"},null,8,["modelValue"])]),_:1}),t(c(I),{class:"btns"},{default:h(()=>[X("button",{class:"confirm",onClick:x},"立即修改")]),_:1})]),_:1},8,["model","rules"])]),_:1}),t(s,{label:"修改密码"},{default:h(()=>[t(c(W),{ref_key:"passwordFormRef",ref:y,model:c(a),rules:c(z),"label-width":"100px"},{default:h(()=>[t(c(I),{label:"原始密码：",prop:"oldPassword",class:"formItemCommon"},{default:h(()=>[t(c(E),{placeholder:"请输入原始密码",modelValue:c(a).oldPassword,"onUpdate:modelValue":u[1]||(u[1]=m=>c(a).oldPassword=m),"input-style":"height:35px;",autocomplete:"off"},null,8,["modelValue"])]),_:1}),t(c(I),{label:"修改密码：",prop:"newPassword"},{default:h(()=>[t(c(E),{placeholder:"请输入新的密码",modelValue:c(a).newPassword,"onUpdate:modelValue":u[2]||(u[2]=m=>c(a).newPassword=m),"input-style":"height:35px;","show-password":"",type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),t(c(I),{label:"确认密码：",prop:"checkPassword"},{default:h(()=>[t(c(E),{placeholder:"请再次输入密码",modelValue:c(a).checkPassword,"onUpdate:modelValue":u[3]||(u[3]=m=>c(a).checkPassword=m),"input-style":"height:35px;","show-password":"",type:"password"},null,8,["modelValue"])]),_:1}),t(c(I),{class:"btns"},{default:h(()=>[X("button",{class:"confirm",onClick:R},"立即修改")]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1})}}},Oe=P({setup(){const e=()=>{G.push("/home")},l=_(!1),i=()=>{G.push("/login"),sessionStorage.clear(),localStorage.clear()};return()=>t("div",{class:"setting"},[t("div",{class:"setting-user"},[t("div",{class:"setting-user-portrait"},[t("img",{src:ye},null)]),t("div",{class:"setting-user-info",title:Y("username")},[Y("username")])]),t("div",{class:"setting-line"},null),t("div",{class:"setting-common"},[t("div",{class:"icon iconfont icon-yonghu"},null),t("div",{class:"setting-common-name",onClick:()=>e()},[O("我的主页")])]),t("div",{class:"setting-common",onClick:()=>{l.value=!0}},[t("div",{class:"icon iconfont icon-xiugai"},null),t("div",{class:"setting-common-name"},[O("我的设置")])]),t(F("el-dialog"),{title:"我的设置",modelValue:l.value,"onUpdate:modelValue":n=>l.value=n,width:"540px"},{default:()=>[t(Fe,{modifyForm:l},null)]}),t("div",{class:"setting-common setting-warn",onClick:()=>i()},[t("div",{class:"icon iconfont icon-h"},null),t("div",{class:"setting-common-name"},[O("退出登录")])])])}});function Ae(){return D({method:"get",url:"/getEditData",headers:{"Content-Type":"application/x-www-form-urlencoded"}})}function Ke(e){return D({method:"post",url:"/delEditData",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{id:e}})}function $e(e){return D({method:"post",url:"/addEditData",headers:{"Content-Type":"application/json;charset=utf-8"},data:e})}function We(e){return D({method:"post",url:"/updateEditData",headers:{"Content-Type":"application/json;charset=utf-8"},data:e})}export{Oe as P,We as a,je as b,B as c,we as d,Q as e,Ke as f,Ae as g,$e as h,Ne as m,ke as r,q as u};
