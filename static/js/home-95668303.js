import{bQ as ae,p as z,aS as H,X as O,a as N,aE as ce,d as l,bL as ue,aV as _,bR as fe,e as I,r as Y,o as me,f as ye,w as p,u as c,h as G,E as M,b as Q,i as F,s as q,bP as J,Q as R,bS as Z}from"./index-94592c9f.js";import{s as E,u as he,c as pe,_ as ge}from"./userStore-77faf1db.js";const ve="page",we="Hello world",be={},xe=[{type:"container-ordinary",style:{position:"relative",width:"100%",zIndex:1},children:[{type:"button",style:{display:"",position:"relative",zIndex:1},buttonstyle:"primary",size:"default",icon:{},twiceComfire:{},bubblePrompt:{triggerMode:"鼠标悬浮",promptLocation:"下"},isDisable:!1,children:"我的按钮"},{type:"text",style:{position:"relative",fontSize:"20px",color:"blue",zIndex:1},children:"(｡･∀･)ﾉﾞ"},{type:"input",value:"",inputStyle:"text",size:"default",defaultValue:"123",placeholder:"",showPassword:!1,maxlength:0,minlength:0,showWordLimit:!0,style:{position:"relative",zIndex:1},children:""}]}],Be={type:ve,title:we,style:be,body:xe},De=ae("dragStore",{state:()=>({selectedMaterial:null,isClone:!1,isDrag:!1,isDraging:!1,selectKey:null,selectParent:null,selectedComponent:null,containerData:null,selectedIndex:null}),actions:{destructionOfDrag:null}}),V=new Map,Ee=e=>(V.clear(),j(e,"page"),V),Re=(e,n)=>{const s=A(z);let t=e+"-"+se();return s.EditorDataMap.set(t,n),t},j=(e,n)=>{let s=e.type+"-"+se(),t=[];return e.body?(e.body.forEach(a=>{t.push(j(a,n))}),V.set(n,{...e,children:t,body:""})):Array.isArray(e.children)?(e.children.forEach(a=>{t.push(j(a,s))}),V.set(s,{parent:n,...e,children:t})):V.set(s,{parent:n,...e}),s},se=()=>"xyxxyxxx".replace(/[xy]/g,function(e){let n=Math.random()*16|0;return(e==="x"?n:n&3|8).toString(16)}),A=ae("mainStore",{state:()=>({title:"新项目",isPreview:!1,EditorData:null,copyData:null,EditorDataMap:null}),actions:{getMap(){this.EditorDataMap=Ee(this.EditorData)}}});function Pe(e){return{all:e=e||new Map,on:function(n,s){var t=e.get(n);t?t.push(s):e.set(n,[s])},off:function(n,s){var t=e.get(n);t&&(s?t.splice(t.indexOf(s)>>>0,1):e.set(n,[]))},emit:function(n,s){var t=e.get(n);t&&t.slice().map(function(a){a(s)}),(t=e.get("*"))&&t.slice().map(function(a){a(n,s)})}}}const ee=Pe();function Ce(){const e=De(z);let n=A(z),s=null,t=null,a=null,d=null,x=0,D=0,v=-1,g=-1,u=[],S=!1;const k=()=>{t==null||t.classList.remove("chosen-container"),s&&s.remove(),a&&a.remove(),s=null,a=null,t=null,e.isClone=!1,e.isDrag=!1,e.isDraging=!1,u=[],document.body.removeEventListener("mousemove",B),document.body.removeEventListener("mousemove",U)},T=(o,r)=>{h(r);const b=w(r.target);ee.emit("cloneStart"),e.isClone=!0,e.selectedMaterial=o,X("ghostClone",b,r),document.body.addEventListener("mousemove",B)},h=o=>{if(!(!$(o.target)&&!e.isClone)){if(e.isClone&&(t&&(e.selectParent=t.attributes["data-id"].nodeValue),ee.emit("cloneEnd"),e.selectedMaterial=null),e.isDrag){if(d){if(d.style.removeProperty("visibility"),document.body.removeEventListener("mousemove",U),S){Array.from(t.children).forEach(P=>{P.style.removeProperty("transform"),P.style.removeProperty("transition")});let r=n.EditorDataMap.get(e.selectKey).parent,b=n.EditorDataMap.get(r).children;b.splice(v,1),b.splice(g,0,e.selectKey),S=!1}d.classList.remove("chosenEl"),d.onmousedown=null}e.isDraging=!1,d=null}k()}};document.body.onmouseup=h;const f=o=>{e.isClone&&(t&&(t.classList.remove("chosen-container"),a&&t.removeChild(a)),t=y(o.target),t.classList.add("chosen-container"),a=document.createElement("div"),a.classList.add("renderEl"),t.appendChild((H(e.selectedMaterial.render(e.selectedMaterial.defaultData),a),a)))},i=o=>{if(e.isClone){t&&t.classList.remove("chosen-container");let r=y(o.target);t.removeChild(a),t==r&&(t=y(o.target.parentNode),t.classList.add("chosen-container"),a=document.createElement("div"),a.classList.add("renderEl"),t.appendChild((H(e.selectedMaterial.render(e.selectedMaterial.defaultData),a),a)))}},w=o=>o.tagName=="DIV"?o.children[0]:o.tagName=="SPAN"?o:w(o.parentNode),y=o=>o.className.includes("container")?o:y(o.parentNode),$=o=>o.parentNode==document.body?!1:o!=null&&o.classList.contains("Editorcontainer")?!0:$(o.parentNode),oe=o=>{if(o.target.classList.contains("Editorcontainer")){t=o.target,o.target.classList.add("chosen-container"),e.selectKey=null;return}d=W(o.target),t=y(d.parentNode),d.classList.add("chosenEl"),t.classList.add("chosen-container"),g=v=[].indexOf.call(t.children,d),ie(),e.isDrag=!0,e.selectKey=d.attributes["data-id"].nodeValue,d.onmousedown=r=>{console.log("正在交换组件中"),e.isDraging=!0,X("ghostDrag",d,r),document.body.addEventListener("mousemove",U)},e.destructionOfDrag=()=>{e.isDrag&&(e.selectKey=null,s&&s.remove(),d&&(d.style.removeProperty("visibility"),document.body.removeEventListener("mousemove",U),t==null||t.classList.remove("chosen-container"),d.classList.remove("chosenEl"),d.onmousedown=null),e.isDraging=!1,e.isDrag=!1,d=null)}},U=o=>{B(o),S=!0;for(let r=0;r<u.length;r++)if(r!==g&&o.clientX>u[r].left&&o.clientX<u[r].right&&o.clientY>u[r].top&&o.clientY<u[r].bottom){if(g<r)for(let m=g;m<r;m++)if(m<v)t.children[m].style.transform="translate3d(0px, 0px, 0)";else{const C=u[m].left-u[m+1].left,L=u[m].top-u[m+1].top;t.children[m+1].style.transform="translate3d("+C+"px, "+L+"px, 0)"}else if(g>r)for(let m=r;m<g;m++)if(v<=m)t.children[m+1].style.transform="translate3d(0px, 0px, 0)";else{const C=u[m+1].left-u[m].left,L=u[m+1].top-u[m].top;t.children[m].style.transform="translate3d("+C+"px, "+L+"px, 0)"}const b=u[r].left-u[v].left,P=u[r].top-u[v].top;d.style.transform="translate3d("+b+"px, "+P+"px, 0)",g=r;break}},ie=()=>{u=[];for(let o of t.children)o.style.setProperty("transition","transform 300ms ease"),u.push(o.getBoundingClientRect())},W=o=>o?o.className&&o.className.includes("container")||o.classList&&o.classList.contains("cannotPreview")?o:W(o.parentNode):null,X=(o,r,b)=>{const{clientY:P,clientX:m}=b,{top:C,left:L,width:re,height:de}=r.getBoundingClientRect();x=m-L,D=P-C,s=document.createElement("div"),s.classList.add(o),s.style.width=`${re}px`,s.style.height=`${de}px`,s.innerHTML=r.outerHTML,document.body.appendChild(s),s.style.top=`${C}px`,s.style.left=`${L}px`},B=({clientY:o,clientX:r})=>{s.style.top=`${o-D}px`,s.style.left=`${r-x}px`};return{cloneMousedown:T,mouseenter:f,mouseleave:i,onclickToDrag:oe,deterWhetherToMoveUp:o=>o()}}const te=Ce(),je=(e,n)=>{const s=e.__vccOpts||e;for(const[t,a]of n)s[t]=a;return s};const ne=O({props:{style:Object,children:Object,childrenList:Array,text:String,class:String},setup(e){let n=N(null);return ce(()=>{n.value.attributes.childrenList=e.childrenList}),()=>l("div",{class:e.class,style:e.style,ref:n,datatype:e.class,onMouseenter:s=>te.mouseenter(s),onMouseleave:s=>te.mouseleave(s)},[e.children.length!=0?e.children:l("span",{class:"nochild"},[e.text])])}}),Le=[{label:"容器",icon:"icon iconfont icon-checkbox",type:"container-ordinary",category:"container",render(e){return e={...e,text:"容器",class:"container-ordinary","data-id":e.id},l(ne,e,null)},defaultData:{type:"container-ordinary",style:{position:"relative",width:"100%",zIndex:1},children:[]}},{label:"自由容器",icon:"icon iconfont icon-zidingyibuju",type:"container-free",category:"container",render(e){return e={...e,text:"自由容器",class:"container-free","data-id":e.id},l(ne,e,null)},defaultData:{type:"container-free",style:{position:"relative",width:"100%",zIndex:1},children:[]}},{label:"文字",icon:"icon iconfont icon-font",type:"text",category:"common",render(e){return l("div",{class:"cannotPreview","data-id":e.id},[l("span",{style:e.style,datatype:"text"},[e.children?e.children:"渲染文字"])])},defaultData:{type:"text",style:{position:"relative",fontSize:"16px",color:"black",zIndex:1},children:"渲染文字"}},{label:"按钮",icon:"icon iconfont icon-anniu",type:"button",category:"common",render(e){return l("div",{class:"cannotPreview","data-id":e.id},[l(ue,{style:e.style,class:"baseButton",type:e.buttonstyle,size:e.size,disabled:e.isDisable},{default:()=>[l("i",{class:["icon iconfont leftIcon",e.icon.leftIcon],style:{"font-size":e.icon.leftIconSize}},null),e.children?e.children:"渲染按钮",l("i",{class:["icon iconfont rightIcon",e.icon.rightIcon],style:{"font-size":e.icon.rightIconSize}},null)]})])},defaultData:{type:"button",style:{position:"relative",width:"87px",height:"32px",zIndex:1},buttonstyle:"",size:"default",icon:{},twiceComfire:{},bubblePrompt:{},isDisable:!0,children:"渲染按钮"}},{label:"输入框",icon:"icon iconfont icon-input",type:"input",category:"common",render(e){return l("div",{class:"cannotPreview","data-id":e.id},[l(_("el-Input"),{modelValue:e.value,"onUpdate:modelValue":n=>e.value=n,style:e.style,size:e.size,type:e.inputStyle,placeholder:e.placeholder,showPassword:e.showPassword,clearable:e.clearable,maxlength:e.maxlength,minlength:e.minlength,"show-word-limit":e.showWordLimit,disabled:e.disabled,readonly:e.readonly,autofocus:e.autofocus,hidden:e.hidden},null)])},defaultData:{type:"input",value:"",inputStyle:"text",size:"default",placeholder:"请输入",showPassword:!1,clearable:!1,maxlength:0,minlength:0,showWordLimit:!1,disabled:!1,readonly:!1,autofocus:!1,hidden:!1,style:{position:"relative",zIndex:1},children:""}},{label:"下拉框",icon:"icon iconfont icon-m-xialacaidan",type:"select",category:"common",render(e){return l("div",{class:"cannotPreview","data-id":e.id},[l(fe,{style:e.style,filterable:e.filterable?e.filterable:!1,placeholder:e.placeholder?e.placeholder:"请选择",modelValue:e.defaultValue,"onUpdate:modelValue":n=>e.defaultValue=n},{default:()=>[e.selectData&&e.selectData.map(n=>l(_("el-option"),{key:n.value,value:n.value},null))]})])},defaultData:{type:"select",style:{position:"relative",zIndex:1},children:"",defaultValue:""}},{label:"文本框",icon:"icon iconfont icon-wenben",type:"textBox",category:"form",render(e){return l("div",{class:"cannotPreview",style:e.style.box,"data-id":e.id},[l("div",{style:e.style.title},[e.title?e.title:"文本"]),l(I,{style:e.style.input,placeholder:e.inputBoxPlaceholder?e.inputBoxPlaceholder:"",clearable:e.clearable?e.clearable:!1,type:e.inputType?e.inputType:"text"},null)])},defaultData:{type:"textBox",title:"文本",style:{box:{display:"block"},title:{},input:{}},children:""}},{label:"多行文本框",icon:"icon iconfont icon-duohangwenben1",type:"multilineText",category:"form",render(e){return l("div",{class:"cannotPreview",style:e.style.box,"data-id":e.id},[l("div",{style:e.style.title},[e.title?e.title:"多行文本"]),l(I,{style:e.style.input,type:"textarea",placeholder:e.inputBoxPlaceholder?e.inputBoxPlaceholder:"",clearable:e.clearable?e.clearable:!1,autosize:e.autosize},null)])},defaultData:{type:"multilineText",title:"多行文本",style:{box:{display:"block"},title:{},input:{}},children:"",autosize:{minRows:2,maxRows:6}}}];class Me{constructor(n=[],s=new Map){this.componentList=n,this.componentMap=s}register(n){this.componentList.push(n),this.componentMap.set(n.type,n)}}const K=new Me;for(let e of Le)K.register({label:e.label,type:e.type,category:e.category,defaultData:e.defaultData,preview:()=>l(Ie,{block:e}),render:n=>e.render(n)});const Ie=O({props:{block:{type:Object}},setup(e){return()=>l("span",{datatype:e.block.type},[l("i",{class:e.block.icon},null),l("label",null,[e.block.label])])}});let le=A(z);const Se=e=>e instanceof Array?e.map(n=>{let s=Se(n.children),t={...n,children:s,style:n.style};return n.type.includes("container")&&(t.childrenList=n.children),K.componentMap.get(n.type).render(t)}):e,Ve=e=>{let n=le.EditorDataMap.get(e);if(n.children instanceof Array)return n.children.map(s=>{var x;let t=Ve(s),a=le.EditorDataMap.get(s),d={...a,id:s,style:a.style};return a.type.includes("container")&&(d.children=t,d.childrenList=a.children),(x=K.componentMap.get(a.type))==null?void 0:x.render(d)})};function ze(e){return E({method:"post",url:"/modfiyUserInfo/modifyUsername",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{username:e}})}function _e(e){return E({method:"post",url:"/modfiyUserInfo/checkPassword",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{password:e}})}function ke(e){return E({method:"post",url:"/modfiyUserInfo/modifyPassword",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{password:e}})}const Ue={__name:"settingPages",props:["modifyForm"],setup(e){const n=e,s=he(z);let t=N(null),a=Y({username:"",oldPassword:"",newPassword:"",checkPassword:""});const d=async(h,f,i)=>{if(f==="")i(new Error("请新的输入用户名"));else{let y=(await pe(a.username)).data;y.status?i(new Error(y.msg)):i()}},x=()=>{t.value.validate(async h=>{if(!h)return;let i=(await ze(a.username)).data;i.status?F.error(i.msg):(F.success(i.msg),s.username=i.username,q("username",i.username),a.username="",n.modifyForm.value=!1,a.username="")})};let D=N(null);const v=async(h,f,i)=>{if(f==="")i(new Error("请输入原始密码"));else{if(a.oldPassword!==""){let w=await _e(a.oldPassword);console.log(w);let y=w.data;y.status?i(new Error(y.msg)):i()}i()}},g=(h,f,i)=>{f===""?i(new Error("请输入密码")):(a.checkPassword!==""&&D.value.validateField("checkPassword"),i())},u=(h,f,i)=>{f===""?i(new Error("请再次输入密码")):f!==a.newPassword?i(new Error("两次输入密码不一致!")):i()},S=()=>{D.value.validate(async h=>{if(!h)return;let i=(await ke(a.newPassword)).data;i.status?F.error(i.msg):(F.success(i.msg),s.password=i.password,q("password",i.password),n.modifyForm.value=!1,a.oldPassword="",a.newPassword="",a.checkPassword="")})};let k=Y({username:[{min:3,max:10,message:"用户名长度应在 3-10 个字符",trigger:"blur"},{validator:d,trigger:"blur"}],oldPassword:[{validator:v,trigger:"blur"}],newPassword:[{min:6,max:15,message:"密码长度应在 6-15 个字符",trigger:"blur"},{validator:g,trigger:"blur"}],checkPassword:[{validator:u,trigger:"blur"}]});const T=()=>{D.value.resetFields(),t.value.resetFields()};return(h,f)=>{const i=_("el-tab-pane"),w=_("el-tabs");return me(),ye(w,{type:"border-card","tab-position":"left",class:"card",onTabClick:T},{default:p(()=>[l(i,{label:"修改用户名"},{default:p(()=>[l(c(G),{ref_key:"usernameFormRef",ref:t,model:c(a),rules:c(k),"label-width":"100px",autocomplete:"off"},{default:p(()=>[l(c(M),{label:"用户名：",prop:"username",class:"formItemCommon"},{default:p(()=>[l(c(I),{placeholder:"请输入新的用户名",modelValue:c(a).username,"onUpdate:modelValue":f[0]||(f[0]=y=>c(a).username=y),"input-style":"height:35px;",autocomplete:"off"},null,8,["modelValue"])]),_:1}),l(c(M),{class:"btns"},{default:p(()=>[Q("button",{class:"confirm",onClick:x},"立即修改")]),_:1})]),_:1},8,["model","rules"])]),_:1}),l(i,{label:"修改密码"},{default:p(()=>[l(c(G),{ref_key:"passwordFormRef",ref:D,model:c(a),rules:c(k),"label-width":"100px"},{default:p(()=>[l(c(M),{label:"原始密码：",prop:"oldPassword",class:"formItemCommon"},{default:p(()=>[l(c(I),{placeholder:"请输入原始密码",modelValue:c(a).oldPassword,"onUpdate:modelValue":f[1]||(f[1]=y=>c(a).oldPassword=y),"input-style":"height:35px;",autocomplete:"off"},null,8,["modelValue"])]),_:1}),l(c(M),{label:"修改密码：",prop:"newPassword"},{default:p(()=>[l(c(I),{placeholder:"请输入新的密码",modelValue:c(a).newPassword,"onUpdate:modelValue":f[2]||(f[2]=y=>c(a).newPassword=y),"input-style":"height:35px;","show-password":"",type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),l(c(M),{label:"确认密码：",prop:"checkPassword"},{default:p(()=>[l(c(I),{placeholder:"请再次输入密码",modelValue:c(a).checkPassword,"onUpdate:modelValue":f[3]||(f[3]=y=>c(a).checkPassword=y),"input-style":"height:35px;","show-password":"",type:"password"},null,8,["modelValue"])]),_:1}),l(c(M),{class:"btns"},{default:p(()=>[Q("button",{class:"confirm",onClick:S},"立即修改")]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1})}}},Oe=O({setup(){const e=()=>{Z.push("/home")},n=N(!1),s=()=>{Z.push("/login"),sessionStorage.clear(),localStorage.clear()};return()=>l("div",{class:"setting"},[l("div",{class:"setting-user"},[l("div",{class:"setting-user-portrait"},[l("img",{src:ge},null)]),l("div",{class:"setting-user-info",title:J("username")},[J("username")])]),l("div",{class:"setting-line"},null),l("div",{class:"setting-common"},[l("div",{class:"icon iconfont icon-yonghu"},null),l("div",{class:"setting-common-name",onClick:()=>e()},[R("我的主页")])]),l("div",{class:"setting-common",onClick:()=>{n.value=!0}},[l("div",{class:"icon iconfont icon-xiugai"},null),l("div",{class:"setting-common-name"},[R("我的设置")])]),l(_("el-dialog"),{title:"我的设置",modelValue:n.value,"onUpdate:modelValue":t=>n.value=t,width:"540px"},{default:()=>[l(Ue,{modifyForm:n},null)]}),l("div",{class:"setting-common setting-warn",onClick:()=>s()},[l("div",{class:"icon iconfont icon-h"},null),l("div",{class:"setting-common-name"},[R("退出登录")])])])}});function Ae(){return E({method:"get",url:"/getEditData",headers:{"Content-Type":"application/x-www-form-urlencoded"}})}function Ke(e){return E({method:"post",url:"/delEditData",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{id:e}})}function $e(e){return E({method:"post",url:"/addEditData",headers:{"Content-Type":"application/json;charset=utf-8"},data:e})}function We(e){return E({method:"post",url:"/updateEditData",headers:{"Content-Type":"application/json;charset=utf-8"},data:e})}export{Oe as P,je as _,Ve as a,We as b,Re as c,De as d,ee as e,Be as f,K as g,Ae as h,Ke as i,$e as j,A as m,Se as r,te as u};
