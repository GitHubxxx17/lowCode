import{p as e}from"../index.70967321.js";import{t,d as n}from"../home/home.c21240f2.js";import{m as a}from"../userStore/userStore.49c50847.js";import{d as s}from"../deepcopy/deepcopy.bcf77b89.js";import{G as i,Z as o,w as l,b as d,U as u,ag as p,F as c,S as m,h as r,Y as v,x as g}from"../@vue/@vue.5b184091.js";import{c as f}from"../element-plus/element-plus.cbbb2b2a.js";import"../pinia/pinia.e5f2e591.js";import"../fundebug-javascript/fundebug-javascript.4b005614.js";import"../dayjs/dayjs.fdf8d021.js";import"../fundebug-vue/fundebug-vue.04a7ac72.js";import"../vue-router/vue-router.f65266be.js";import"../lodash-es/lodash-es.3125e237.js";import"../@vueuse/@vueuse.9fc9a9b5.js";import"../@element-plus/@element-plus.cb377f36.js";import"../@ctrl/@ctrl.91de2ec7.js";import"../async-validator/async-validator.8d480e59.js";import"../memoize-one/memoize-one.63ab667a.js";import"../escape-html/escape-html.5fea19da.js";import"../normalize-wheel-es/normalize-wheel-es.3222b0a2.js";import"../@floating-ui/@floating-ui.01901ece.js";import"../axios/axios.5ae1da96.js";import"../mitt/mitt.f0e54764.js";import"../type-detect/type-detect.74abd79c.js";const h=i({props:{option:{type:Object},isShow:{type:Boolean}},setup(e){const n=o({menuActive:e.option.title,openeds:["1","2","3","4","5"],data:s(t.handlerMap.get(e.option.title).defaultData),action:s(e.option)}),a=()=>{n.menuActive==n.action.title&&(n.data.value=n.action.content,"消息提醒"==n.menuActive&&(n.action.messageType&&(n.data.messageType.value=n.action.messageType),n.action.duration&&(n.data.duration.value=n.action.duration),n.action.messageContent&&(n.data.messageContent.value=n.action.messageContent)))};return l((()=>e.isShow),(i=>{i&&(n.menuActive=e.option.title,n.data=s(t.handlerMap.get(e.option.title).defaultData),n.action=s(e.option),a())}),{immediate:!0}),l((()=>n.menuActive),(()=>{n.data=s(t.handlerMap.get(n.menuActive).defaultData),a()}),{immediate:!0}),d((()=>{e.option.title=n.menuActive,e.option.content=n.data.value,"消息提醒"==n.menuActive&&(n.data.messageType&&(e.option.messageType=n.data.messageType.value),n.data.duration&&(e.option.duration=n.data.duration.value),n.data.messageContent&&(e.option.messageContent=n.data.messageContent.value,e.option.content=n.data.messageContent.value)),"组件可见性"==n.menuActive&&(e.option.otherOption.isHidden=n.data.isHidden,e.option.otherOption.target=n.data.target)})),()=>u(c,null,[u("div",{class:"events-config"},[u("div",{class:"events-config-menu"},[u(p("el-menu"),{"default-active":n.menuActive,"default-openeds":n.openeds,onSelect:e=>{n.menuActive=e}},{default:()=>[u(p("el-sub-menu"),{index:"1"},{default:()=>u(c,null,[u(p("el-menu-item"),{index:"跳转连接"},{default:()=>[m("跳转连接")]}),u(p("el-menu-item"),{index:"刷新页面"},{default:()=>[m("刷新页面")]}),u(p("el-menu-item"),{index:"回退页面"},{default:()=>[m("回退页面")]})]),title:()=>u("span",null,[m("页面")])}),u(p("el-sub-menu"),{index:"2"},{default:()=>u(c,null,[u(p("el-menu-item"),{index:"打开弹窗"},{default:()=>[m("打开弹窗")]}),u(p("el-menu-item"),{index:"关闭弹窗"},{default:()=>[m("关闭弹窗")]}),u(p("el-menu-item"),{index:"消息提醒"},{default:()=>[m("消息提醒")]})]),title:()=>u("span",null,[m("弹窗")])}),u(p("el-sub-menu"),{index:"3"},{default:()=>u(c,null,[u(p("el-menu-item"),{index:"发送请求"},{default:()=>[m("发送请求")]})]),title:()=>u("span",null,[m("服务")])}),u(p("el-sub-menu"),{index:"4"},{default:()=>u(c,null,[u(p("el-menu-item"),{index:"提交表单"},{default:()=>[m("提交表单")]}),u(p("el-menu-item"),{index:"重置表单"},{default:()=>[m("重置表单")]}),u(p("el-menu-item"),{index:"校验表单"},{default:()=>[m("校验表单")]})]),title:()=>u("span",null,[m("表单")])}),u(p("el-sub-menu"),{index:"5"},{default:()=>u(c,null,[u(p("el-menu-item"),{index:"组件可见性"},{default:()=>[m("组件可见性")]})]),title:()=>u("span",null,[m("组件")])})]})]),u("div",{class:"events-config-content"},[u("div",{class:"events-config-content-item"},[u("h3",{class:"events-config-content-item-title"},[m("动作说明")]),u("p",null,[t.handlerMap.get(n.menuActive).instructions])]),u("div",{class:"events-config-content-item"},[u("h3",{class:"events-config-content-item-title"},[m("动作配置")]),t.handlerMap.get(n.menuActive).configRender(n.data)])])])])}});const y=i({props:{EditorData:Object},setup(){const i=n(e),d=a(e);let y=o({dialogIsShow:!1,addListIsShow:!1,eventsList:d.EditorDataMap.get(i.selectKey||"page").events||[],activeName:Array.from(t.eventMap.keys()),addAction:{title:"跳转连接",content:"",otherOption:{}},selectedEvent:null,selectedIndex:0,mouseEventsMap:new Map,isUpdate:!1});l((()=>i.selectKey),((e,n)=>{0==y.eventsList.length?delete d.EditorDataMap.get(n||"page").events:d.EditorDataMap.get(n||"page").events=y.eventsList,y.eventsList=d.EditorDataMap.get(e||"page").events||[],y.selectedEvent=null;for(let a of t.eventMap)y.mouseEventsMap.get(a[0]).exist=!1;for(let t of y.eventsList)y.mouseEventsMap.get(t.type).exist=!0}));const j=()=>{y.addListIsShow=!1};r((()=>{var e;for(let[n,a]of t.eventMap)y.mouseEventsMap.set(n,{type:a.type,name:a.name,exist:null==(e=y.mouseEventsMap.get(a.type))?void 0:e.exist});d.EditorDataMap.get(i.selectKey||"page").events||0!=y.eventsList.length||(d.EditorDataMap.get(i.selectKey||"page").events=y.eventsList),window.addEventListener("click",j)})),v((()=>{window.removeEventListener("click",j)}));const x=()=>{y.addAction=s({title:"跳转连接",content:"",otherOption:{}})};return()=>{let e;return u(c,null,[u("div",{class:"events"},[u("div",{class:"events-addEvents",onClick:e=>{e.stopPropagation(),y.addListIsShow=!y.addListIsShow}},[u("span",null,[m("添加事件")])]),y.addListIsShow&&u("div",{class:"events-addEvents-list"},[u("ul",null,[Array.from(y.mouseEventsMap.values()).map((e=>u("li",{onClick:t=>{t.stopPropagation(),e.exist||((e=>{y.eventsList.push({type:e.type,name:e.name,list:[]}),e.exist=!0})(e),j())},class:e.exist?"disabled":""},[e.name])))])]),u(p("elCollapse"),{modelValue:y.activeName,"onUpdate:modelValue":e=>y.activeName=e},(n=e=y.eventsList.map(((e,n)=>u("div",{class:"events-elCollapseItem"},[u("div",{class:"events-nav"},[u("i",{class:"icon iconfont icon-tianjia",onClick:t=>{return n=e,y.isUpdate=!1,x(),y.dialogIsShow=!0,void(y.selectedEvent=n);var n}},null),u("i",{class:"icon iconfont icon-shanchu",onClick:e=>{return t=n,y.mouseEventsMap.get(y.eventsList[t].type).exist=!1,void y.eventsList.splice(t,1);var t}},null)]),u(p("elCollapseItem"),{title:e.name,name:e.type},{default:()=>[u("div",{class:"events-list"},[e.list.map(((n,a)=>u("div",{class:"events-list-item"},[u("div",{class:"events-list-item-header"},[u("span",null,[n.title]),u("span",null,[u("i",{class:"icon iconfont icon-xiugai",onClick:t=>{return n=e,i=a,y.isUpdate=!0,y.addAction=s(n.list[i]),y.dialogIsShow=!0,y.selectedEvent=n,void(y.selectedIndex=i);var n,i}},null),u("i",{class:"icon iconfont icon-shanchu",onClick:t=>((e,t)=>{e.list.splice(t,1)})(e,a)},null)])]),u("div",{class:"events-list-item-content"},[t.handlerMap.get(n.title).selectedRender(n)])])))])]})]))),"function"==typeof n||"[object Object]"===Object.prototype.toString.call(n)&&!g(n)?e:{default:()=>[e]}))]),u(p("el-dialog"),{title:"事件配置",modelValue:y.dialogIsShow,"onUpdate:modelValue":e=>y.dialogIsShow=e,width:"60%",fullscreen:!0,"append-to-body":!0},{default:()=>u(h,{option:y.addAction,isShow:y.dialogIsShow},null),footer:()=>u("span",{class:"dialog-footer"},[u(p("el-button"),{onClick:e=>y.dialogIsShow=!1},{default:()=>[m("取 消")]}),u(p("el-button"),{type:"primary",onClick:e=>{""!=y.addAction.content.trim()?(y.dialogIsShow=!1,y.isUpdate?y.selectedEvent.list[y.selectedIndex]=s(y.addAction):y.selectedEvent.list.push(s(y.addAction)),x()):f.warning("内容不能为空")}},{default:()=>[m("确 定")]})])})]);var n}}});export{y as default};
