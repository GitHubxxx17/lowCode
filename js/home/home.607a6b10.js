import{p as e,s as t,b as n,r as o}from"../index.3ae1860b.js";import{m as l,a,e as i,s,u as r,c as d,_ as c}from"../userStore/userStore.879988be.js";import{c as u,a as p,k as m,g,b as f,E as y}from"../element-plus/element-plus.739d7a40.js";import{w as h,au as v,G as w,U as b,ag as C,F as E,x,S as D,r as P,h as M,K as k,Z as S,o as L,M as R,O as T,u as K,a as O}from"../@vue/@vue.5b184091.js";import{d as N}from"../pinia/pinia.e5f2e591.js";import{d as V}from"../deepcopy/deepcopy.bcf77b89.js";const j=N("dragStore",{state:()=>({selectedMaterial:null,isClone:!1,isDrag:!1,isDraging:!1,selectKey:null,selectParent:null,selectedComponent:null,containerData:null,selectedIndex:null,dragEl:null}),actions:{destructionOfDrag:null}}),I=j(e),z=l(e),U=(e,t)=>{let n=!1,o=null;const l=e=>{if(!n)for(let a=0;a<e.length;a++){const i=e[a];if(i.getAttribute("data-key")==t)return n=!0,void(o=i);if(i.className.includes("container"))return l(i.children[0].children)}};for(let a=0;a<e.length&&!n;a++){if(e[a].getAttribute("data-key")==t)return e[a];e[a].className.includes("container")&&l(e[a].children[0].children)}return o},_=e=>{if(!e.classList)return null;let t=[...e.classList];return t.includes("is-expanded")||t.includes("cannotPreview")||t.includes("container-ordinary")?e:_(e.parentNode)},F=e=>{var t;let n=z.EditorDataMap.get(e),o=null==(t=z.EditorDataMap.get(n.parent))?void 0:t.children;for(let l=0;l<o.length;l++)if(o[l-1]==e)return o[l];return"page"==n.parent?"page":F(n.parent)},B=e=>{var t;z.menuConfig.selectKey=null==(t=_(e.target))?void 0:t.getAttribute("data-key"),z.menuConfig.selectKey==I.selectKey?(z.menuConfig.isShow.selectComponent=!0,z.menuConfig.isShow.unselectComponent=!1,z.menuConfig.isShow.moveForward=!1,z.menuConfig.isShow.moveBack=!1):(z.menuConfig.isShow.selectComponent=!1,z.menuConfig.isShow.unselectComponent=!0,z.menuConfig.isShow.moveForward=!0,z.menuConfig.isShow.moveBack=!0),z.menuConfig.selectKey;const n=window.innerHeight||document.documentElement.clientHeight;e.preventDefault(),z.menuConfig.isShowMenu=!0,n-e.y<390?(e.x<100?z.menuConfig.style.left=e.x+"px":z.menuConfig.style.left=e.x-100+"px",z.menuConfig.style.top=e.y-390+"px"):(z.menuConfig.style.left=e.x+"px",z.menuConfig.style.top=e.y+"px"),e.stopPropagation()},A=()=>{z.menuConfig.isShowMenu=!1},$=e=>{z.menuConfig.isShow.selectComponent?u.info("该组件已经被选中啦！"):z.menuConfig.selectKey?(z.menuConfig.elOutlineTree&&z.menuConfig.elOutlineTree.setCurrentKey(z.menuConfig.selectKey),I.selectKey=z.menuConfig.selectKey,z.menuConfig.isShowMenu=!1):u.error("无法选中！"),e.stopPropagation()},H=e=>{z.menuConfig.isShow.unselectComponent?u.info("这个组件不需要取消选中嘞！"):(I.selectKey=null,z.menuConfig.elOutlineTree&&z.menuConfig.elOutlineTree.setCurrentKey(null),z.menuConfig.isShowMenu=!1),e.stopPropagation()},X=(e,t)=>{z.menuConfig.isShow.makeACopy?u.info("不可以复制该组件哦！"):(z.copyData=z.menuConfig.selectKey,z.wantCopy=z.menuConfig.selectKey,t.paste(),z.menuConfig.isShowMenu=!1),e.stopPropagation()},Y=e=>{z.menuConfig.isShow.copycomponents?u.info("不可以复制该组件哦！"):(z.copyData=z.menuConfig.selectKey,z.menuConfig.isShowMenu=!1),e.stopPropagation()},W=(e,t)=>{z.menuConfig.isShow.delComponents?u.info("不可以删除该组件哦！"):(z.wantDel=z.menuConfig.selectKey,t.delete(),z.menuConfig.isShowMenu=!1),e.stopPropagation()},q=(e,t)=>{z.menuConfig.isShow.shearComponents?u.info("不可以剪切该组件哦！"):(z.copyData=z.menuConfig.selectKey,z.menuConfig.isShowMenu=!1,W(e,t)),e.stopPropagation()},G=e=>{var t;if(z.copyData){if(z.menuConfig.isShow.pasteComponents)u.info("不可以粘贴到该组件哦！");else{let e=function(){s(),d(),z.menuConfig.key++},n=function(){r(),i(),z.menuConfig.key--},o=z.EditorDataMap.get(z.menuConfig.selectKey),l=null==(t=z.EditorDataMap.get(o.parent))?void 0:t.children,a=-1;for(let t=0;t<l.length;t++)if(l[t+1]==z.menuConfig.selectKey){a=t;break}let{delUndo:i,delRedo:s}=J(),{copyUndo:r,copyRedo:d}=Z(a,o.parent);e(),z.queue.push({redo:e,undo:n}),z.curPointerTo+=1,z.menuConfig.isShowMenu=!1}e.stopPropagation()}else u.error("还没有复制组件配置哦！")},J=()=>{var e;let t=z.menuConfig.selectKey;if(t){let n=(null==(e=z.EditorDataMap.get(t))?void 0:e.parent)||"page",o=z.EditorDataMap.get(n).children.findIndex((e=>e==t));return{delRedo(){z.EditorDataMap.get(n).children.splice(o,1),z.EditorDataMap.get(n)},delUndo(){z.EditorDataMap.get(n).children.splice(o,0,t),z.EditorDataMap.get(n)}}}u.error("编辑区域根节点不能被粘贴配置！")},Z=(e,t)=>{let n=z.copyData,o=z.EditorDataMap.get(n),l=[];return{copyRedo(){z.EditorDataMap.get(t).children.splice(e+1,0,function e(t,n,o){o.parent=n;let i=a(t.replace(/-[^-]*$/,""),V(o));return l.push(i),Array.isArray(o.children)&&(z.EditorDataMap.get(i).children=o.children.map((t=>e(t,i,z.EditorDataMap.get(t))))),i}(n,t,o))},copyUndo(){z.EditorDataMap.get(t).children.splice(e+1,1),l.forEach((e=>{z.EditorDataMap.delete(e)}))}}},Q=e=>{if(z.menuConfig.isShow.moveForward)u.error("未选中该节点！");else{let e=(e=>{var t;let n=z.EditorDataMap.get(e),o=null==(t=z.EditorDataMap.get(n.parent))?void 0:t.children;for(let l=0;l<o.length;l++)if(o[l+1]==e)return o[l];return n.parent})(z.menuConfig.selectKey);z.menuConfig.elOutlineTree&&z.menuConfig.elOutlineTree.setCurrentKey(e),z.rootNode&&(I.dragEl=U(z.rootNode.children,e)),z.menuConfig.isShowMenu=!1}e.stopPropagation()},ee=e=>{if(z.menuConfig.isShow.moveForward)u.error("未选中该节点！");else{let e=F(z.menuConfig.selectKey);z.menuConfig.elOutlineTree&&z.menuConfig.elOutlineTree.setCurrentKey(e),z.rootNode&&(I.dragEl=U(z.rootNode.children,e)),z.menuConfig.isShowMenu=!1}e.stopPropagation()},te=(e,t)=>{z.menuConfig.isShow.undo?u.error("这个组件没有撤销的空间！"):(t.undo(),z.menuConfig.isShowMenu=!1),e.stopPropagation()},ne=(e,t)=>{z.menuConfig.isShow.redo?u.error("这个组件没有还原的空间！"):(t.redo(),z.menuConfig.isShowMenu=!1),e.stopPropagation()};const oe=function(){const t=j(e);let n=l(e),o=null,a=null,s=null,r=0,d=0,c=-1,u=[],p=null,m=!1,g=!1,f=null,y=!0;h((()=>t.dragEl),((e,o)=>{e&&void 0===x(e)&&(t.dragEl=o),o&&(o.classList.remove("chosenEl"),C(o.parentNode).classList.remove("chosen-container")),e?(n.rootNode.classList.remove("chosen-container"),a=C(e.parentNode),e.classList.add("chosenEl"),a.classList.add("chosen-container")):n.rootNode.classList.add("chosen-container")})),h((()=>t.selectKey),(e=>{n.modify.curData=JSON.stringify(n.EditorDataMap.get(e||"page")),y||(t.dragEl=U(n.rootNode.children[0].children,e))})),h((()=>t.isDraging),(e=>{e||i.emit("dragEnd")}));const w=()=>{o&&o.remove(),s&&s.remove(),o=null,s=null,t.selectedMaterial=null,t.isClone=!1,t.isDrag||(null==a||a.classList.remove("chosen-container"),a=null,t.isDrag=!1,u=[]),t.isDraging=!1,clearTimeout(p),m=!1,g=!1,document.body.removeEventListener("mousemove",R),document.body.removeEventListener("mousemove",M)};document.body.onmouseup=e=>{if(!E(e.target))return w(),void(y=!1);y=!0,t.isClone&&a&&(t.selectParent=x(a),i.emit("cloneEnd")),(t.isClone||t.isDrag)&&(n.isNeedSave=!0),w();let o=setTimeout((()=>{n.modify.disabled=!1,clearTimeout(o)}),0)};const b=e=>"DIV"==e.tagName?e.children[0]:"SPAN"==e.tagName?e:b(e.parentNode),C=e=>e.className.includes("container")||e.className.includes("Editorcontainer")?e:C(e.parentNode),E=e=>e.parentNode!=document.body&&(!!(null==e?void 0:e.classList.contains("Editorcontainer"))||E(e.parentNode)),x=e=>{var t;return null==(t=e.attributes["data-key"])?void 0:t.nodeValue},D=()=>{new Promise((e=>{let o=x(f),l=n.EditorDataMap.get(o).children,i=n.EditorDataMap.get(t.selectKey).parent;n.EditorDataMap.get(i).children.splice(c,1),l.push(t.selectKey),n.EditorDataMap.get(t.selectKey).parent=o,a=f,e(l)})).then((e=>{c=e.length-1,t.dragEl=a.children[0].children[c],t.dragEl,t.dragEl.onmousedown=P,k(),m=!1,g=!1}))},P=e=>{n.modify.disabled=!0,i.emit("dragStart"),c=[].indexOf.call(a.children[0].children,t.dragEl),k(),t.isDraging=!0,L("ghostDrag",t.dragEl,e),document.body.addEventListener("mousemove",M)},M=e=>{E(e.target)&&p&&!g&&(clearTimeout(p),m&&(p=setTimeout(D,300))),R(e);for(let o=0;o<u.length;o++)if(o!==c&&e.clientX>u[o].left&&e.clientX<u[o].right&&e.clientY>u[o].top&&e.clientY<u[o].bottom){let e=n.EditorDataMap.get(t.selectKey).parent,l=n.EditorDataMap.get(e).children;l.splice(c,1),l.splice(o,0,t.selectKey),k(),c=o}},k=()=>{u=[];for(let e of a.children[0].children)u.push(e.getBoundingClientRect())},S=e=>e==document.body?null:"transition"==(null==e?void 0:e.parentNode.className)?e:"transition"==e.className?e.parentNode:"cannotPreview"==e.className?e:S(e.parentNode),L=(e,t,n)=>{const{clientY:l,clientX:a}=n,{top:i,left:s,width:c,height:u}=t.getBoundingClientRect();r=a-s,d=l-i,o=document.createElement("div"),o.classList.add(e),o.style.width=`${c}px`,o.style.height=`${u}px`,o.innerHTML=t.outerHTML,document.body.appendChild(o),o.style.top=`${i}px`,o.style.left=`${s}px`},R=({clientY:e,clientX:t})=>{o.style.top=e-d+"px",o.style.left=t-r+"px"};return{cloneMousedown:(e,o)=>{const l=b(o.target);t.isClone=!0,t.selectedMaterial=e,n.modify.disabled=!0,L("ghostClone",l,o),document.body.addEventListener("mousemove",R)},mouseenter:e=>{if(t.isClone&&(a&&(a.classList.remove("chosen-container"),s&&a.removeChild(s)),a=C(e.target),a.classList.add("chosen-container"),s=document.createElement("div"),s.classList.add("renderEl"),a.appendChild((v(t.selectedMaterial.render({node:t.selectedMaterial.defaultData}),s),s))),t.isDraging){if(clearTimeout(p),t.dragEl==e.target||e.target.classList.contains("Editorcontainer"))return;m=!0,g=!1,f=e.target,p=setTimeout(D,300)}},mouseleave:e=>{if(t.isClone&&(a&&a.classList.remove("chosen-container"),a.removeChild(s),a=C(e.target.parentNode),a.classList.add("chosen-container"),s=document.createElement("div"),s.classList.add("renderEl"),a.appendChild((v(t.selectedMaterial.render({node:t.selectedMaterial.defaultData}),s),s))),t.isDraging){if(m=!1,e.target!=a)return;f=C(e.target.parentNode),g=!0,p=setTimeout(D,300)}},onclickToDrag:e=>{if(e.target.classList.contains("Editorcontainer"))return a=e.target,e.target.classList.add("chosen-container"),t.selectKey=null,t.dragEl&&(t.dragEl.onmousedown=null),void(t.dragEl=null);S(e.target).classList.contains("Editorcontainer")||e.target!=t.dragEl&&(t.dragEl&&(t.dragEl.onmousedown=null),t.isDrag=!0,t.dragEl=S(e.target)||e.target,t.selectKey=x(t.dragEl),t.dragEl.onmousedown=P,t.destructionOfDrag=()=>{t.isDrag&&(t.selectKey=null,o&&o.remove(),t.dragEl&&(document.body.removeEventListener("mousemove",M),null==a||a.classList.remove("chosen-container"),t.dragEl.classList.remove("chosenEl"),t.dragEl.onmousedown=null),t.isDraging=!1,t.isDrag=!1,t.dragEl=null)})},deterWhetherToMoveUp:e=>e()}}(),le=w({props:{option:{type:Object}},setup:e=>()=>b("div",{class:"elCollapseItem base-settings base-events"},[b("p",null,[e.option.label]),b(C("el-input-number"),{modelValue:e.option.value,"onUpdate:modelValue":t=>e.option.value=t,min:e.option.min,max:e.option.max},null)])}),ae=w({props:{option:{type:Object}},setup:e=>()=>b(E,null,[b("div",{class:"elCollapseItem base-settings-textarea-text"},[b("div",null,[e.option.label])]),b("div",{class:"elCollapseItem base-settings-textarea"},[b(p,{type:"textarea",modelValue:e.option.value,"onUpdate:modelValue":t=>e.option.value=t},null)])])});const ie=w({props:{option:{type:Object}},setup:e=>()=>{let t;return b("div",{class:"elCollapseItem base-settings base-events"},[b("p",null,[e.option.label]),b(C("el-button-group"),null,(n=t=e.option.list.map((t=>b(C("el-button"),{class:"disabled-el-button",type:t.value==e.option.value?"primary":"",onClick:n=>{e.option.value=t.value}},{default:()=>[t.label]}))),"function"==typeof n||"[object Object]"===Object.prototype.toString.call(n)&&!x(n)?t:{default:()=>[t]}))]);var n}}),se=""+new URL("../../png/noneData3.4ac3.png",import.meta.url).href,re=[{type:"跳转连接",instructions:"跳转到指定连接的页面",configRender:e=>b(ae,{option:e},null),selectedRender:e=>b("p",null,[D("跳转至："),b("span",{class:"events-url"},[e.content])]),handler:e=>()=>{window.open(e.content,"_blank")},defaultData:{label:"页面地址",value:""}},{type:"刷新页面",instructions:"触发浏览器刷新页面",configRender:()=>b("div",{class:"events-none"},[b("img",{src:se},null),b("p",null,[D("无配置内容")])]),selectedRender:e=>b("p",null,[b("span",null,[e.content])]),handler:()=>()=>{location.reload()},defaultData:{value:"刷新页面"}},{type:"回退页面",instructions:"触发浏览器回退",configRender:()=>b("div",{class:"events-none"},[b("img",{src:se},null),b("p",null,[D("无配置内容")])]),selectedRender:e=>b("p",null,[b("span",null,[e.content])]),handler:()=>()=>{history.go(-1)},defaultData:{value:"回退页面"}},{type:"打开弹窗",instructions:"打开弹窗",configRender:e=>b(ae,{option:e},null),selectedRender:e=>b("p",null,[b("span",null,[e])]),handler:()=>{},defaultData:{label:"页面地址",value:""}},{type:"关闭弹窗",instructions:"关闭弹窗",configRender:e=>b(ae,{option:e},null),selectedRender:e=>b("p",null,[D("跳转至："),b("span",null,[e])]),handler:()=>{},defaultData:{label:"页面地址",value:""}},{type:"消息提醒",instructions:"出现消息提醒框",configRender:e=>b(E,null,[b(ie,{option:e.messageType},null),b(le,{option:e.duration},null),b(ae,{option:e.messageContent},null)]),selectedRender:function(e){let t="成功";return this.defaultData.messageType.list.map((n=>{n.value==e.messageType&&(t=n.label)})),b("p",null,[t,D("消息："),b("span",null,[e.messageContent])])},handler:e=>()=>{u({type:e.messageType,message:e.messageContent,duration:e.duration})},defaultData:{messageType:{label:"消息类型",list:[{label:"成功",value:"success"},{label:"警告",value:"warning"},{label:"提示",value:"info"},{label:"错误",value:"error"}],value:"success"},duration:{label:"持续时间",min:0,value:3e3},messageContent:{label:"消息内容",value:""},value:""}},{type:"发送请求",instructions:"发送请求",configRender:e=>b(ae,{option:e},null),selectedRender:e=>b("p",null,[D("跳转至："),b("span",null,[e])]),handler:()=>{},defaultData:{label:"页面地址",value:""}},{type:"提交表单",instructions:"提交表单",configRender:e=>b(ae,{option:e},null),selectedRender:e=>b("p",null,[D("跳转至："),b("span",null,[e])]),handler:()=>{},defaultData:{label:"页面地址",value:""}},{type:"重置表单",instructions:"重置表单",configRender:e=>b(ae,{option:e},null),selectedRender:e=>b("p",null,[D("跳转至："),b("span",null,[e])]),handler:()=>{},defaultData:{label:"页面地址",value:""}},{type:"校验表单",instructions:"校验表单",configRender:e=>b(ae,{option:e},null),selectedRender:e=>b("p",null,[D("跳转至："),b("span",null,[e])]),handler:()=>{},defaultData:{label:"页面地址",value:""}}],de=[{type:"onclick",name:"鼠标点击",execute:e=>({onClick:()=>{e.forEach((e=>e&&e()))}})},{type:"mouseenter",name:"鼠标移入",execute:e=>({onMouseenter:()=>{e.forEach((e=>e&&e()))}})},{type:"mouseleave",name:"鼠标移出",execute:e=>({onmouseleave:()=>{e.forEach((e=>e&&e()))}})},{type:"onfocus",name:"获取焦点",execute:e=>({onFocus:()=>{e.forEach((e=>e&&e()))}})},{type:"onblur",name:"失去焦点",execute:e=>({onBlur:()=>{e.forEach((e=>e&&e()))}})},{type:"onchange",name:"值改变",execute:e=>({onChange:()=>{e.forEach((e=>e&&e()))}})}];const ce=new class{constructor(e=new Map,t=new Map){this.handlerMap=e,this.eventMap=t}getRenderEvents(e){return e.reduce(((e,t)=>Object.assign(e,this.eventMap.get(t.type).execute(t.list.map((e=>this.handlerMap.get(e.title).handler(e)))))),{})}register(e,t=!1){t?this.eventMap.set(e.type,e):this.handlerMap.set(e.type,e)}};for(let Le of re)ce.register({type:Le.type,instructions:Le.instructions,defaultData:Le.defaultData,configRender:Le.configRender,selectedRender:Le.selectedRender,handler:Le.handler});for(let Le of de)ce.register({type:Le.type,name:Le.name,execute:Le.execute},!0);const ue=w({props:{style:Object,children:Object,childrenList:Array,text:String,class:String,events:Object,node:Object},setup(e){let t=P(null);return M((()=>{t.value.attributes.childrenList=e.childrenList})),()=>b("div",k({class:e.class,style:e.style,ref:t,datatype:e.class,onMouseenter:e=>oe.mouseenter(e),onMouseleave:e=>oe.mouseleave(e)},e.events),[0!=(null==e?void 0:e.children.length)&&e.children,0==(null==e?void 0:e.node.children.length)&&b("span",{class:"nochild"},[e.text])])}}),pe=w({props:{option:{type:Object},events:{type:Object}},setup:e=>()=>b(p,k({modelValue:e.option.value,"onUpdate:modelValue":t=>e.option.value=t,style:e.option.style,size:e.option.size,type:e.option.inputStyle,placeholder:e.option.placeholder,showPassword:e.option.showPassword,clearable:e.option.clearable,"show-word-limit":e.option.showWordLimit,disabled:e.option.disabled,readonly:e.option.readonly,autofocus:e.option.autofocus,maxlength:e.option.maxlength,minlength:e.option.minlength},e.events),null)}),me=w({props:{option:{type:Object},events:{type:Object}},setup:e=>()=>b(m,k({style:e.option.style,filterable:!!e.option.filterable&&e.option.filterable,placeholder:e.option.placeholder?e.option.placeholder:"请选择",modelValue:e.option.defaultValue,"onUpdate:modelValue":t=>e.option.defaultValue=t},e.events),{default:()=>[e.option.selectData&&e.option.selectData.map((e=>b(C("el-option"),{key:e.value,value:e.value},null)))]})}),ge=w({props:{option:{type:Object},events:{type:Object}},setup:e=>()=>b(E,null,[b("div",{style:e.option.style.title},[e.option.title?e.option.title:"文本"]),b(p,k({modelValue:e.option.value,"onUpdate:modelValue":t=>e.option.value=t,style:e.option.style.input,placeholder:e.option.inputBoxPlaceholder?e.option.inputBoxPlaceholder:"",clearable:!!e.option.clearable&&e.option.clearable,type:e.option.inputType?e.option.inputType:"text"},e.events),null)])}),fe=w({props:{option:{type:Object},events:{type:Object}},setup:e=>()=>b(E,null,[b("div",{style:e.option.style.title},[e.option.title?e.option.title:"多行文本"]),b(p,k({modelValue:e.option.value,"onUpdate:modelValue":t=>e.option.value=t,style:e.option.style.input,type:"textarea",placeholder:e.option.inputBoxPlaceholder?e.option.inputBoxPlaceholder:"",clearable:!!e.option.clearable&&e.option.clearable,rows:e.option.autosize.minRows},e.events),null)])}),ye=[{label:"用户",icon:"icon iconfont icon-yonghu"},{label:"退出",icon:"icon iconfont icon-h"},{label:"叉 关闭",icon:"icon iconfont icon-cha"},{label:"叉 关闭",icon:"icon iconfont icon-cha1"},{label:"连接",icon:"icon iconfont icon-ai70"},{label:"密码",icon:"icon iconfont icon-mima"},{label:"返回 左箭头",icon:"icon iconfont icon-fanhui"},{label:"搜索",icon:"icon iconfont icon-search"},{label:"笑脸",icon:"icon iconfont icon-xiaolian"},{label:"菜单",icon:"icon iconfont icon-caidan"},{label:"修改",icon:"icon iconfont icon-xiugai"}],he=l(e),ve=[{label:"容器",icon:"icon iconfont icon-checkbox",type:"container-ordinary",category:"container",render(e){var t;const{children:n,childrenList:o}=e;return e={node:e.node,children:n||[],childrenList:o,style:e.node.style,text:"容器",class:"container-ordinary","data-key":e.id,events:(null==(t=e.node)?void 0:t.events)&&he.isPreview?ce.getRenderEvents(e.node.events):{}},b(ue,e,null)},defaultData:{type:"container-ordinary",style:{position:"relative",width:"100%",zIndex:1},children:[]}},{label:"自由容器",icon:"icon iconfont icon-zidingyibuju",type:"container-free",category:"container",render(e){var t;const{children:n,childrenList:o}=e;return e={node:e.node,children:n||[],childrenList:o,style:e.node.style,text:"自由容器",class:"container-free","data-key":e.id,events:(null==(t=e.node)?void 0:t.events)&&he.isPreview?ce.getRenderEvents(e.node.events):{}},b(ue,e,null)},defaultData:{type:"container-free",style:{position:"relative",width:"100%",zIndex:1},children:[]}},{label:"文字",icon:"icon iconfont icon-font",type:"text",category:"common",render(e){var t;let n=(null==(t=e.node)?void 0:t.events)&&he.isPreview?ce.getRenderEvents(e.node.events):{};return b("div",{class:"cannotPreview","data-key":e.id},[b("span",k({style:e.node.style},n,{datatype:"text"}),[e.node.children?e.node.children:"渲染文字"])])},defaultData:{type:"text",style:{position:"relative",fontSize:"16px",color:"black",zIndex:1},children:"渲染文字"}},{label:"按钮",icon:"icon iconfont icon-anniu",type:"button",category:"common",render(e){var t;let n=(null==(t=e.node)?void 0:t.events)&&he.isPreview?ce.getRenderEvents(e.node.events):{};return b("div",{class:"cannotPreview","data-key":e.id},[b(g,k({style:e.node.style,class:"baseButton",type:e.node.buttonstyle,size:e.node.size,disabled:e.node.isDisable},n),{default:()=>[b("i",{class:["icon iconfont leftIcon",e.node.icon.leftIcon],style:{"font-size":e.node.icon.leftIconSize}},null),e.node.children?e.node.children:"渲染按钮",b("i",{class:["icon iconfont rightIcon",e.node.icon.rightIcon],style:{"font-size":e.node.icon.rightIconSize}},null)]})])},defaultData:{type:"button",style:{position:"relative",width:"87px",height:"32px",zIndex:1},buttonstyle:"",size:"default",icon:{},twiceComfire:{},bubblePrompt:{},isDisable:!1,children:"渲染按钮"}},{label:"输入框",icon:"icon iconfont icon-input",type:"input",category:"common",render(e){var t;let n=(null==(t=e.node)?void 0:t.events)&&he.isPreview?ce.getRenderEvents(e.node.events):{};return b("div",{class:"cannotPreview","data-key":e.id},[b(pe,{option:e.node,events:n},null)])},defaultData:{type:"input",value:"",inputStyle:"text",size:"default",placeholder:"请输入",showPassword:!1,clearable:!1,showWordLimit:!1,disabled:!1,readonly:!1,autofocus:!1,style:{position:"relative",zIndex:1},children:""}},{label:"下拉框",icon:"icon iconfont icon-m-xialacaidan",type:"select",category:"common",render(e){var t;let n=(null==(t=e.node)?void 0:t.events)&&he.isPreview?ce.getRenderEvents(e.node.events):{};return b("div",{class:"cannotPreview","data-key":e.id},[b(me,{option:e.node,events:n},null)])},defaultData:{type:"select",style:{position:"relative",zIndex:1},children:"",defaultValue:""}},{label:"文本框",icon:"icon iconfont icon-wenben",type:"textBox",category:"form",render(e){var t;let n=(null==(t=e.node)?void 0:t.events)&&he.isPreview?ce.getRenderEvents(e.node.events):{};return b("div",{class:"cannotPreview",style:e.node.style.box,"data-key":e.id},[b(ge,{option:e.node,events:n},null)])},defaultData:{value:"",type:"textBox",title:"文本",style:{box:{display:"block"},title:{},input:{}},children:""}},{label:"多行文本框",icon:"icon iconfont icon-duohangwenben1",type:"multilineText",category:"form",render(e){var t;let n=(null==(t=e.node)?void 0:t.events)&&he.isPreview?ce.getRenderEvents(e.node.events):{};return b("div",{class:"cannotPreview",style:e.node.style.box,"data-key":e.id},[b(fe,{option:e.node,events:n},null)])},defaultData:{value:"",type:"multilineText",title:"多行文本",style:{box:{display:"block"},title:{},input:{}},children:"",autosize:{minRows:2,maxRows:6}}}];const we=new class{constructor(e=[],t=new Map,n=[]){this.componentList=e,this.componentMap=t,this.iconList=n}register(e,t=!1){t?this.iconList.push(e):this.componentList.push(e),this.componentMap.set(e.type,e)}};for(let Le of ve)we.register({label:Le.label,type:Le.type,category:Le.category,defaultData:Le.defaultData,display:!0,preview:()=>b(be,{block:Le}),render:e=>Le.render(e)});for(let Le of ye)we.register({label:Le.label,type:"icon",category:"icon",display:!0,defaultData:{icon:Le.icon,type:"icon",style:{position:"relative",fontSize:"16px",color:"black",zIndex:1},children:""},preview:()=>b("span",{datatype:"icon",class:"iconSpan"},[b("i",{class:Le.icon},null)]),render:e=>b("div",{class:"cannotPreview","data-key":e.id},[b("i",{class:e.node.icon,style:e.node.style},null)])},!0);const be=w({props:{block:{type:Object}},setup:e=>()=>b("span",{datatype:e.block.type},[b("i",{class:e.block.icon},null),b("label",null,[e.block.label])])});const Ce={__name:"settingPages",props:["modifyForm"],setup(n){const o=n,l=r(e);let a=P(null),i=S({username:"",oldPassword:"",newPassword:"",checkPassword:""});const c=()=>{a.value.validate((async e=>{if(!e)return;var n;let a=(await(n=i.username,s({method:"post",url:"/modfiyUserInfo/modifyUsername",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{username:n}}))).data;a.status?u.error(a.msg):(u.success(a.msg),l.username=a.username,t("username",a.username),i.username="",o.modifyForm.value=!1,i.username="")}))};let m=P(null);const g=()=>{m.value.validate((async e=>{if(!e)return;var n;let a=(await(n=i.newPassword,s({method:"post",url:"/modfiyUserInfo/modifyPassword",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{password:n}}))).data;a.status?u.error(a.msg):(u.success(a.msg),l.password=a.password,t("password",a.password),o.modifyForm.value=!1,i.oldPassword="",i.newPassword="",i.checkPassword="")}))};let h=S({username:[{min:3,max:10,message:"用户名长度应在 3-10 个字符",trigger:"blur"},{validator:async(e,t,n)=>{if(""===t)n(new Error("请新的输入用户名"));else{let e=(await d(i.username)).data;e.status?n(new Error(e.msg)):n()}},trigger:"blur"}],oldPassword:[{validator:async(e,t,n)=>{if(""===t)n(new Error("请输入原始密码"));else{if(""!==i.oldPassword){let e=await(o=i.oldPassword,s({method:"post",url:"/modfiyUserInfo/checkPassword",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{password:o}})),t=e.data;t.status?n(new Error(t.msg)):n()}n()}var o},trigger:"blur"}],newPassword:[{min:6,max:15,message:"密码长度应在 6-15 个字符",trigger:"blur"},{validator:(e,t,n)=>{""===t?n(new Error("请输入密码")):(""!==i.checkPassword&&m.value.validateField("checkPassword"),n())},trigger:"blur"}],checkPassword:[{validator:(e,t,n)=>{""===t?n(new Error("请再次输入密码")):t!==i.newPassword?n(new Error("两次输入密码不一致!")):n()},trigger:"blur"}]});const v=()=>{m.value.resetFields(),a.value.resetFields()};return(e,t)=>{const n=C("el-tab-pane"),o=C("el-tabs");return L(),R(o,{type:"border-card","tab-position":"left",class:"card",onTabClick:v},{default:T((()=>[b(n,{label:"修改用户名"},{default:T((()=>[b(K(f),{ref_key:"usernameFormRef",ref:a,model:K(i),rules:K(h),"label-width":"100px",autocomplete:"off"},{default:T((()=>[b(K(y),{label:"用户名：",prop:"username",class:"formItemCommon"},{default:T((()=>[b(K(p),{placeholder:"请输入新的用户名",modelValue:K(i).username,"onUpdate:modelValue":t[0]||(t[0]=e=>K(i).username=e),"input-style":"height:35px;",autocomplete:"off"},null,8,["modelValue"])])),_:1}),b(K(y),{class:"btns"},{default:T((()=>[O("button",{class:"confirm",onClick:c},"立即修改")])),_:1})])),_:1},8,["model","rules"])])),_:1}),b(n,{label:"修改密码"},{default:T((()=>[b(K(f),{ref_key:"passwordFormRef",ref:m,model:K(i),rules:K(h),"label-width":"100px"},{default:T((()=>[b(K(y),{label:"原始密码：",prop:"oldPassword",class:"formItemCommon"},{default:T((()=>[b(K(p),{placeholder:"请输入原始密码",modelValue:K(i).oldPassword,"onUpdate:modelValue":t[1]||(t[1]=e=>K(i).oldPassword=e),"input-style":"height:35px;",autocomplete:"off"},null,8,["modelValue"])])),_:1}),b(K(y),{label:"修改密码：",prop:"newPassword"},{default:T((()=>[b(K(p),{placeholder:"请输入新的密码",modelValue:K(i).newPassword,"onUpdate:modelValue":t[2]||(t[2]=e=>K(i).newPassword=e),"input-style":"height:35px;","show-password":"",type:"password",autocomplete:"off"},null,8,["modelValue"])])),_:1}),b(K(y),{label:"确认密码：",prop:"checkPassword"},{default:T((()=>[b(K(p),{placeholder:"请再次输入密码",modelValue:K(i).checkPassword,"onUpdate:modelValue":t[3]||(t[3]=e=>K(i).checkPassword=e),"input-style":"height:35px;","show-password":"",type:"password"},null,8,["modelValue"])])),_:1}),b(K(y),{class:"btns"},{default:T((()=>[O("button",{class:"confirm",onClick:g},"立即修改")])),_:1})])),_:1},8,["model","rules"])])),_:1})])),_:1})}}},Ee=w({setup(){const e=P(!1);return()=>b("div",{class:"setting"},[b("div",{class:"setting-user"},[b("div",{class:"setting-user-portrait"},[b("img",{src:c},null)]),b("div",{class:"setting-user-info",title:n("username")},[n("username")])]),b("div",{class:"setting-line"},null),b("div",{class:"setting-common"},[b("div",{class:"icon iconfont icon-yonghu"},null),b("div",{class:"setting-common-name",onClick:()=>{o.push("/home")}},[D("我的主页")])]),b("div",{class:"setting-common",onClick:()=>{e.value=!0}},[b("div",{class:"icon iconfont icon-xiugai"},null),b("div",{class:"setting-common-name"},[D("我的设置")])]),b(C("el-dialog"),{title:"我的设置",modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,width:"540px"},{default:()=>[b(Ce,{modifyForm:e},null)]}),b("div",{class:"setting-common setting-warn",onClick:()=>(o.push("/login"),sessionStorage.clear(),void localStorage.clear())},[b("div",{class:"icon iconfont icon-h"},null),b("div",{class:"setting-common-name"},[D("退出登录")])])])}});let xe=l(e);const De=e=>{let t=xe.EditorDataMap.get(e);if(t.children instanceof Array)return t.children.map((e=>{var t;let n=De(e),o=xe.EditorDataMap.get(e),l=S({node:o,id:e,style:o.style});return o.type.includes("container")&&(l.children=n,l.childrenList=o.children),null==(t=we.componentMap.get(o.type))?void 0:t.render(l)}))};function Pe(){return s({method:"get",url:"/getEditData",headers:{"Content-Type":"application/x-www-form-urlencoded"}})}function Me(e){return s({method:"post",url:"/delEditData",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{id:e}})}function ke(e){return s({method:"post",url:"/addEditData",headers:{"Content-Type":"application/json;charset=utf-8"},data:e})}function Se(e){return s({method:"post",url:"/updateEditData",headers:{"Content-Type":"application/json;charset=utf-8"},data:e})}export{ae as B,Ee as P,we as a,le as b,A as c,j as d,ce as e,Se as f,$ as g,H as h,X as i,Y as j,q as k,W as l,De as m,Q as n,ee as o,G as p,te as q,ne as r,B as s,Pe as t,oe as u,Me as v,ke as w};
