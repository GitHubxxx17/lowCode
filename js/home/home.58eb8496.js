import{p as e,s as t,b as n,r as o}from"../index.fa470b0b.js";import{m as l,a,s as i,u as s,c as r,_ as d}from"../userStore/userStore.7b3fe222.js";import{c,a as u,k as p,g as m,b as g,E as f}from"../element-plus/element-plus.739d7a40.js";import{w as h,au as y,G as v,U as w,ag as b,F as C,x as E,S as x,r as D,h as P,K as M,Z as k,o as S,M as L,O as R,u as T,a as K}from"../@vue/@vue.5b184091.js";import{d as j}from"../pinia/pinia.e5f2e591.js";import{m as O}from"../mitt/mitt.f0e54764.js";import{d as V}from"../deepcopy/deepcopy.bcf77b89.js";const N=j("dragStore",{state:()=>({selectedMaterial:null,isClone:!1,isDrag:!1,isDraging:!1,selectKey:null,selectParent:null,selectedComponent:null,containerData:null,selectedIndex:null,dragEl:null}),actions:{destructionOfDrag:null}}),I=O(),z=N(e),U=l(e),_=(e,t)=>{let n=!1,o=null;const l=e=>{if(!n)for(let a=0;a<e.length;a++){const i=e[a];if(i.getAttribute("data-key")==t)return n=!0,void(o=i);if(i.className.includes("container"))return l(i.children[0].children)}};for(let a=0;a<e.length&&!n;a++){if(e[a].getAttribute("data-key")==t)return e[a];e[a].className.includes("container")&&l(e[a].children[0].children)}return o},F=e=>{if(!e.classList)return null;let t=[...e.classList];return t.includes("is-expanded")||t.includes("cannotPreview")||t.includes("container-ordinary")?e:F(e.parentNode)},B=e=>{var t;let n=U.EditorDataMap.get(e),o=null==(t=U.EditorDataMap.get(n.parent))?void 0:t.children;for(let l=0;l<o.length;l++)if(o[l-1]==e)return o[l];return"page"==n.parent?"page":B(n.parent)},A=e=>{var t;U.menuConfig.selectKey=null==(t=F(e.target))?void 0:t.getAttribute("data-key"),U.menuConfig.selectKey==z.selectKey?(U.menuConfig.isShow.selectComponent=!0,U.menuConfig.isShow.unselectComponent=!1,U.menuConfig.isShow.moveForward=!1,U.menuConfig.isShow.moveBack=!1):(U.menuConfig.isShow.selectComponent=!1,U.menuConfig.isShow.unselectComponent=!0,U.menuConfig.isShow.moveForward=!0,U.menuConfig.isShow.moveBack=!0),U.menuConfig.selectKey;const n=window.innerHeight||document.documentElement.clientHeight;e.preventDefault(),U.menuConfig.isShowMenu=!0,n-e.y<390?(e.x<100?U.menuConfig.style.left=e.x+"px":U.menuConfig.style.left=e.x-100+"px",U.menuConfig.style.top=e.y-390+"px"):(U.menuConfig.style.left=e.x+"px",U.menuConfig.style.top=e.y+"px"),e.stopPropagation()},$=()=>{U.menuConfig.isShowMenu=!1},H=e=>{U.menuConfig.isShow.selectComponent?c.info("该组件已经被选中啦！"):U.menuConfig.selectKey?(U.menuConfig.elOutlineTree&&U.menuConfig.elOutlineTree.setCurrentKey(U.menuConfig.selectKey),z.selectKey=U.menuConfig.selectKey,U.menuConfig.isShowMenu=!1):c.error("无法选中！"),e.stopPropagation()},X=e=>{U.menuConfig.isShow.unselectComponent?c.info("这个组件不需要取消选中嘞！"):(z.selectKey=null,U.menuConfig.elOutlineTree&&U.menuConfig.elOutlineTree.setCurrentKey(null),U.menuConfig.isShowMenu=!1),e.stopPropagation()},Y=(e,t)=>{U.menuConfig.isShow.makeACopy?c.info("不可以复制该组件哦！"):(U.copyData=U.menuConfig.selectKey,U.wantCopy=U.menuConfig.selectKey,t.paste(),U.menuConfig.isShowMenu=!1),e.stopPropagation()},W=e=>{U.menuConfig.isShow.copycomponents?c.info("不可以复制该组件哦！"):(U.copyData=U.menuConfig.selectKey,U.menuConfig.isShowMenu=!1),e.stopPropagation()},q=(e,t)=>{U.menuConfig.isShow.delComponents?c.info("不可以删除该组件哦！"):(U.wantDel=U.menuConfig.selectKey,t.delete(),U.menuConfig.isShowMenu=!1),e.stopPropagation()},G=(e,t)=>{U.menuConfig.isShow.shearComponents?c.info("不可以剪切该组件哦！"):(U.copyData=U.menuConfig.selectKey,U.menuConfig.isShowMenu=!1,q(e,t)),e.stopPropagation()},Z=e=>{var t;if(U.copyData){if(U.menuConfig.isShow.pasteComponents)c.info("不可以粘贴到该组件哦！");else{let e=function(){s(),d(),U.menuConfig.key++},n=function(){r(),i(),U.menuConfig.key--},o=U.EditorDataMap.get(U.menuConfig.selectKey),l=null==(t=U.EditorDataMap.get(o.parent))?void 0:t.children,a=-1;for(let t=0;t<l.length;t++)if(l[t+1]==U.menuConfig.selectKey){a=t;break}let{delUndo:i,delRedo:s}=J(),{copyUndo:r,copyRedo:d}=Q(a,o.parent);e(),U.queue.push({redo:e,undo:n}),U.curPointerTo+=1,U.menuConfig.isShowMenu=!1}e.stopPropagation()}else c.error("还没有复制组件配置哦！")},J=()=>{var e;let t=U.menuConfig.selectKey;if(t){let n=(null==(e=U.EditorDataMap.get(t))?void 0:e.parent)||"page",o=U.EditorDataMap.get(n).children.findIndex((e=>e==t));return{delRedo(){U.EditorDataMap.get(n).children.splice(o,1),U.EditorDataMap.get(n)},delUndo(){U.EditorDataMap.get(n).children.splice(o,0,t),U.EditorDataMap.get(n)}}}c.error("编辑区域根节点不能被粘贴配置！")},Q=(e,t)=>{let n=U.copyData,o=U.EditorDataMap.get(n),l=[];return{copyRedo(){U.EditorDataMap.get(t).children.splice(e+1,0,function e(t,n,o){o.parent=n;let i=a(t.replace(/-[^-]*$/,""),V(o));return l.push(i),Array.isArray(o.children)&&(U.EditorDataMap.get(i).children=o.children.map((t=>e(t,i,U.EditorDataMap.get(t))))),i}(n,t,o))},copyUndo(){U.EditorDataMap.get(t).children.splice(e+1,1),l.forEach((e=>{U.EditorDataMap.delete(e)}))}}},ee=e=>{if(U.menuConfig.isShow.moveForward)c.error("未选中该节点！");else{let e=(e=>{var t;let n=U.EditorDataMap.get(e),o=null==(t=U.EditorDataMap.get(n.parent))?void 0:t.children;for(let l=0;l<o.length;l++)if(o[l+1]==e)return o[l];return n.parent})(U.menuConfig.selectKey);U.menuConfig.elOutlineTree&&U.menuConfig.elOutlineTree.setCurrentKey(e),U.rootNode&&(z.dragEl=_(U.rootNode.children,e)),U.menuConfig.isShowMenu=!1}e.stopPropagation()},te=e=>{if(U.menuConfig.isShow.moveForward)c.error("未选中该节点！");else{let e=B(U.menuConfig.selectKey);U.menuConfig.elOutlineTree&&U.menuConfig.elOutlineTree.setCurrentKey(e),U.rootNode&&(z.dragEl=_(U.rootNode.children,e)),U.menuConfig.isShowMenu=!1}e.stopPropagation()},ne=(e,t)=>{U.menuConfig.isShow.undo?c.error("这个组件没有撤销的空间！"):(t.undo(),U.menuConfig.isShowMenu=!1),e.stopPropagation()},oe=(e,t)=>{U.menuConfig.isShow.redo?c.error("这个组件没有还原的空间！"):(t.redo(),U.menuConfig.isShowMenu=!1),e.stopPropagation()};const le=function(){const t=N(e);let n=l(e),o=null,a=null,i=null,s=0,r=0,d=-1,c=[],u=null,p=!1,m=!1,g=null,f=!0;h((()=>t.dragEl),((e,o)=>{e&&void 0===E(e)&&(t.dragEl=o),o&&(o.classList.remove("chosenEl"),b(o.parentNode).classList.remove("chosen-container")),e?(n.rootNode.classList.remove("chosen-container"),a=b(e.parentNode),e.classList.add("chosenEl"),a.classList.add("chosen-container")):n.rootNode.classList.add("chosen-container")})),h((()=>t.selectKey),(e=>{f||(t.dragEl=_(n.rootNode.children[0].children,e))}));const v=()=>{o&&o.remove(),i&&i.remove(),o=null,i=null,t.selectedMaterial=null,t.isClone=!1,t.isDrag||(null==a||a.classList.remove("chosen-container"),a=null,t.isDrag=!1,c=[]),t.isDraging=!1,clearTimeout(u),p=!1,m=!1,document.body.removeEventListener("mousemove",L),document.body.removeEventListener("mousemove",P)};document.body.onmouseup=e=>{if(!C(e.target))return v(),void(f=!1);f=!0,t.isClone&&a&&(t.selectParent=E(a),I.emit("cloneEnd")),(t.isClone||t.isDrag)&&(n.isNeedSave=!0),v()};const w=e=>"DIV"==e.tagName?e.children[0]:"SPAN"==e.tagName?e:w(e.parentNode),b=e=>e.className.includes("container")||e.className.includes("Editorcontainer")?e:b(e.parentNode),C=e=>e.parentNode!=document.body&&(!!(null==e?void 0:e.classList.contains("Editorcontainer"))||C(e.parentNode)),E=e=>{var t;return null==(t=e.attributes["data-key"])?void 0:t.nodeValue},x=()=>{new Promise((e=>{let o=E(g),l=n.EditorDataMap.get(o).children,i=n.EditorDataMap.get(t.selectKey).parent;n.EditorDataMap.get(i).children.splice(d,1),l.push(t.selectKey),n.EditorDataMap.get(t.selectKey).parent=o,a=g,e(l)})).then((e=>{d=e.length-1,t.dragEl=a.children[0].children[d],t.dragEl,t.dragEl.onmousedown=D,M(),p=!1,m=!1}))},D=e=>{d=[].indexOf.call(a.children[0].children,t.dragEl),M(),t.isDraging=!0,S("ghostDrag",t.dragEl,e),document.body.addEventListener("mousemove",P)},P=e=>{C(e.target)&&u&&!m&&(clearTimeout(u),p&&(u=setTimeout(x,300))),L(e);for(let o=0;o<c.length;o++)if(o!==d&&e.clientX>c[o].left&&e.clientX<c[o].right&&e.clientY>c[o].top&&e.clientY<c[o].bottom){let e=n.EditorDataMap.get(t.selectKey).parent,l=n.EditorDataMap.get(e).children;l.splice(d,1),l.splice(o,0,t.selectKey),M(),d=o}},M=()=>{c=[];for(let e of a.children[0].children)c.push(e.getBoundingClientRect())},k=e=>e==document.body?null:"transition"==(null==e?void 0:e.parentNode.className)?e:"transition"==e.className?e.parentNode:"cannotPreview"==e.className?e:k(e.parentNode),S=(e,t,n)=>{const{clientY:l,clientX:a}=n,{top:i,left:d,width:c,height:u}=t.getBoundingClientRect();s=a-d,r=l-i,o=document.createElement("div"),o.classList.add(e),o.style.width=`${c}px`,o.style.height=`${u}px`,o.innerHTML=t.outerHTML,document.body.appendChild(o),o.style.top=`${i}px`,o.style.left=`${d}px`},L=({clientY:e,clientX:t})=>{o.style.top=e-r+"px",o.style.left=t-s+"px"};return{cloneMousedown:(e,n)=>{const o=w(n.target);t.isClone=!0,t.selectedMaterial=e,S("ghostClone",o,n),document.body.addEventListener("mousemove",L)},mouseenter:e=>{if(t.isClone&&(a&&(a.classList.remove("chosen-container"),i&&a.removeChild(i)),a=b(e.target),a.classList.add("chosen-container"),i=document.createElement("div"),i.classList.add("renderEl"),a.appendChild((y(t.selectedMaterial.render({node:t.selectedMaterial.defaultData}),i),i))),t.isDraging){if(clearTimeout(u),t.dragEl==e.target||e.target.classList.contains("Editorcontainer"))return;p=!0,m=!1,g=e.target,u=setTimeout(x,300)}},mouseleave:e=>{if(t.isClone&&(a&&a.classList.remove("chosen-container"),a.removeChild(i),a=b(e.target.parentNode),a.classList.add("chosen-container"),i=document.createElement("div"),i.classList.add("renderEl"),a.appendChild((y(t.selectedMaterial.render({node:t.selectedMaterial.defaultData}),i),i))),t.isDraging){if(p=!1,e.target!=a)return;g=b(e.target.parentNode),m=!0,u=setTimeout(x,300)}},onclickToDrag:e=>{if(e.target,k(e.target),e.target.classList.contains("Editorcontainer"))return a=e.target,e.target.classList.add("chosen-container"),t.selectKey=null,t.dragEl&&(t.dragEl.onmousedown=null),void(t.dragEl=null);k(e.target).classList.contains("Editorcontainer")||e.target!=t.dragEl&&(t.dragEl&&(t.dragEl.onmousedown=null),t.isDrag=!0,t.dragEl=k(e.target)||e.target,t.selectKey=E(t.dragEl),t.dragEl,t.dragEl.onmousedown=D,t.destructionOfDrag=()=>{t.isDrag&&(t.selectKey=null,o&&o.remove(),t.dragEl&&(document.body.removeEventListener("mousemove",P),null==a||a.classList.remove("chosen-container"),t.dragEl.classList.remove("chosenEl"),t.dragEl.onmousedown=null),t.isDraging=!1,t.isDrag=!1,t.dragEl=null)})},deterWhetherToMoveUp:e=>e()}}(),ae=v({props:{option:{type:Object}},setup:e=>()=>w("div",{class:"elCollapseItem base-settings base-events"},[w("p",null,[e.option.label]),w(b("el-input-number"),{modelValue:e.option.value,"onUpdate:modelValue":t=>e.option.value=t,min:e.option.min,max:e.option.max},null)])}),ie=v({props:{option:{type:Object}},setup:e=>()=>w(C,null,[w("div",{class:"elCollapseItem base-settings-textarea-text"},[w("div",null,[e.option.label])]),w("div",{class:"elCollapseItem base-settings-textarea"},[w(u,{type:"textarea",modelValue:e.option.value,"onUpdate:modelValue":t=>e.option.value=t},null)])])});const se=v({props:{option:{type:Object}},setup:e=>()=>{let t;return w("div",{class:"elCollapseItem base-settings base-events"},[w("p",null,[e.option.label]),w(b("el-button-group"),null,(n=t=e.option.list.map((t=>w(b("el-button"),{class:"disabled-el-button",type:t.value==e.option.value?"primary":"",onClick:n=>{e.option.value=t.value}},{default:()=>[t.label]}))),"function"==typeof n||"[object Object]"===Object.prototype.toString.call(n)&&!E(n)?t:{default:()=>[t]}))]);var n}}),re=""+new URL("../../png/noneData3.4ac3.png",import.meta.url).href,de=[{type:"跳转连接",instructions:"跳转到指定连接的页面",configRender:e=>w(ie,{option:e},null),selectedRender:e=>w("p",null,[x("跳转至："),w("span",{class:"events-url"},[e.content])]),handler:e=>()=>{window.open(e.content,"_blank")},defaultData:{label:"页面地址",value:""}},{type:"刷新页面",instructions:"触发浏览器刷新页面",configRender:()=>w("div",{class:"events-none"},[w("img",{src:re},null),w("p",null,[x("无配置内容")])]),selectedRender:e=>w("p",null,[w("span",null,[e.content])]),handler:()=>()=>{location.reload()},defaultData:{value:"刷新页面"}},{type:"回退页面",instructions:"触发浏览器回退",configRender:()=>w("div",{class:"events-none"},[w("img",{src:re},null),w("p",null,[x("无配置内容")])]),selectedRender:e=>w("p",null,[w("span",null,[e.content])]),handler:()=>()=>{history.go(-1)},defaultData:{value:"回退页面"}},{type:"打开弹窗",instructions:"打开弹窗",configRender:e=>w(ie,{option:e},null),selectedRender:e=>w("p",null,[w("span",null,[e])]),handler:()=>{},defaultData:{label:"页面地址",value:""}},{type:"关闭弹窗",instructions:"关闭弹窗",configRender:e=>w(ie,{option:e},null),selectedRender:e=>w("p",null,[x("跳转至："),w("span",null,[e])]),handler:()=>{},defaultData:{label:"页面地址",value:""}},{type:"消息提醒",instructions:"出现消息提醒框",configRender:e=>w(C,null,[w(se,{option:e.messageType},null),w(ae,{option:e.duration},null),w(ie,{option:e.messageContent},null)]),selectedRender:function(e){let t="成功";return this.defaultData.messageType.list.map((n=>{n.value==e.messageType&&(t=n.label)})),w("p",null,[t,x("消息："),w("span",null,[e.messageContent])])},handler:e=>()=>{c({type:e.messageType,message:e.messageContent,duration:e.duration})},defaultData:{messageType:{label:"消息类型",list:[{label:"成功",value:"success"},{label:"警告",value:"warning"},{label:"提示",value:"info"},{label:"错误",value:"error"}],value:"success"},duration:{label:"持续时间",min:0,value:3e3},messageContent:{label:"消息内容",value:""},value:""}},{type:"发送请求",instructions:"发送请求",configRender:e=>w(ie,{option:e},null),selectedRender:e=>w("p",null,[x("跳转至："),w("span",null,[e])]),handler:()=>{},defaultData:{label:"页面地址",value:""}},{type:"提交表单",instructions:"提交表单",configRender:e=>w(ie,{option:e},null),selectedRender:e=>w("p",null,[x("跳转至："),w("span",null,[e])]),handler:()=>{},defaultData:{label:"页面地址",value:""}},{type:"重置表单",instructions:"重置表单",configRender:e=>w(ie,{option:e},null),selectedRender:e=>w("p",null,[x("跳转至："),w("span",null,[e])]),handler:()=>{},defaultData:{label:"页面地址",value:""}},{type:"校验表单",instructions:"校验表单",configRender:e=>w(ie,{option:e},null),selectedRender:e=>w("p",null,[x("跳转至："),w("span",null,[e])]),handler:()=>{},defaultData:{label:"页面地址",value:""}}],ce=[{type:"onclick",name:"鼠标点击",execute:e=>({onClick:()=>{e.forEach((e=>e&&e()))}})},{type:"mouseenter",name:"鼠标移入",execute:e=>({onMouseenter:()=>{e.forEach((e=>e&&e()))}})},{type:"mouseleave",name:"鼠标移出",execute:e=>({onmouseleave:()=>{e.forEach((e=>e&&e()))}})},{type:"onfocus",name:"获取焦点",execute:e=>({onFocus:()=>{e.forEach((e=>e&&e()))}})},{type:"onblur",name:"失去焦点",execute:e=>({onBlur:()=>{e.forEach((e=>e&&e()))}})},{type:"onchange",name:"值改变",execute:e=>({onChange:()=>{e.forEach((e=>e&&e()))}})}];const ue=new class{constructor(e=new Map,t=new Map){this.handlerMap=e,this.eventMap=t}getRenderEvents(e){return e.reduce(((e,t)=>Object.assign(e,this.eventMap.get(t.type).execute(t.list.map((e=>this.handlerMap.get(e.title).handler(e)))))),{})}register(e,t=!1){t?this.eventMap.set(e.type,e):this.handlerMap.set(e.type,e)}};for(let Re of de)ue.register({type:Re.type,instructions:Re.instructions,defaultData:Re.defaultData,configRender:Re.configRender,selectedRender:Re.selectedRender,handler:Re.handler});for(let Re of ce)ue.register({type:Re.type,name:Re.name,execute:Re.execute},!0);const pe=v({props:{style:Object,children:Object,childrenList:Array,text:String,class:String,events:Object,node:Object},setup(e){let t=D(null);return P((()=>{t.value.attributes.childrenList=e.childrenList})),()=>w("div",M({class:e.class,style:e.style,ref:t,datatype:e.class,onMouseenter:e=>le.mouseenter(e),onMouseleave:e=>le.mouseleave(e)},e.events),[0!=(null==e?void 0:e.children.length)&&e.children,0==(null==e?void 0:e.node.children.length)&&w("span",{class:"nochild"},[e.text])])}}),me=v({props:{option:{type:Object},events:{type:Object}},setup:e=>()=>w(u,M({modelValue:e.option.value,"onUpdate:modelValue":t=>e.option.value=t,style:e.option.style,size:e.option.size,type:e.option.inputStyle,placeholder:e.option.placeholder,showPassword:e.option.showPassword,clearable:e.option.clearable,"show-word-limit":e.option.showWordLimit,disabled:e.option.disabled,readonly:e.option.readonly,autofocus:e.option.autofocus,maxlength:e.option.maxlength,minlength:e.option.minlength},e.events),null)}),ge=v({props:{option:{type:Object},events:{type:Object}},setup:e=>()=>w(p,M({style:e.option.style,filterable:!!e.option.filterable&&e.option.filterable,placeholder:e.option.placeholder?e.option.placeholder:"请选择",modelValue:e.option.defaultValue,"onUpdate:modelValue":t=>e.option.defaultValue=t},e.events),{default:()=>[e.option.selectData&&e.option.selectData.map((e=>w(b("el-option"),{key:e.value,value:e.value},null)))]})}),fe=v({props:{option:{type:Object},events:{type:Object}},setup:e=>()=>w(C,null,[w("div",{style:e.option.style.title},[e.option.title?e.option.title:"文本"]),w(u,M({modelValue:e.option.value,"onUpdate:modelValue":t=>e.option.value=t,style:e.option.style.input,placeholder:e.option.inputBoxPlaceholder?e.option.inputBoxPlaceholder:"",clearable:!!e.option.clearable&&e.option.clearable,type:e.option.inputType?e.option.inputType:"text"},e.events),null)])}),he=v({props:{option:{type:Object},events:{type:Object}},setup:e=>()=>w(C,null,[w("div",{style:e.option.style.title},[e.option.title?e.option.title:"多行文本"]),w(u,M({modelValue:e.option.value,"onUpdate:modelValue":t=>e.option.value=t,style:e.option.style.input,type:"textarea",placeholder:e.option.inputBoxPlaceholder?e.option.inputBoxPlaceholder:"",clearable:!!e.option.clearable&&e.option.clearable,rows:e.option.autosize.minRows},e.events),null)])}),ye=[{label:"用户",icon:"icon iconfont icon-yonghu"},{label:"退出",icon:"icon iconfont icon-h"},{label:"叉 关闭",icon:"icon iconfont icon-cha"},{label:"叉 关闭",icon:"icon iconfont icon-cha1"},{label:"连接",icon:"icon iconfont icon-ai70"},{label:"密码",icon:"icon iconfont icon-mima"},{label:"返回 左箭头",icon:"icon iconfont icon-fanhui"},{label:"搜索",icon:"icon iconfont icon-search"},{label:"笑脸",icon:"icon iconfont icon-xiaolian"},{label:"菜单",icon:"icon iconfont icon-caidan"},{label:"修改",icon:"icon iconfont icon-xiugai"}],ve=l(e),we=[{label:"容器",icon:"icon iconfont icon-checkbox",type:"container-ordinary",category:"container",render(e){var t;const{children:n,childrenList:o}=e;return e={node:e.node,children:n||[],childrenList:o,style:e.node.style,text:"容器",class:"container-ordinary","data-key":e.id,events:(null==(t=e.node)?void 0:t.events)&&ve.isPreview?ue.getRenderEvents(e.node.events):{}},w(pe,e,null)},defaultData:{type:"container-ordinary",style:{position:"relative",width:"100%",zIndex:1},children:[]}},{label:"自由容器",icon:"icon iconfont icon-zidingyibuju",type:"container-free",category:"container",render(e){var t;const{children:n,childrenList:o}=e;return e={node:e.node,children:n||[],childrenList:o,style:e.node.style,text:"自由容器",class:"container-free","data-key":e.id,events:(null==(t=e.node)?void 0:t.events)&&ve.isPreview?ue.getRenderEvents(e.node.events):{}},w(pe,e,null)},defaultData:{type:"container-free",style:{position:"relative",width:"100%",zIndex:1},children:[]}},{label:"文字",icon:"icon iconfont icon-font",type:"text",category:"common",render(e){var t;let n=(null==(t=e.node)?void 0:t.events)&&ve.isPreview?ue.getRenderEvents(e.node.events):{};return w("div",{class:"cannotPreview","data-key":e.id},[w("span",M({style:e.node.style},n,{datatype:"text"}),[e.node.children?e.node.children:"渲染文字"])])},defaultData:{type:"text",style:{position:"relative",fontSize:"16px",color:"black",zIndex:1},children:"渲染文字"}},{label:"按钮",icon:"icon iconfont icon-anniu",type:"button",category:"common",render(e){var t;let n=(null==(t=e.node)?void 0:t.events)&&ve.isPreview?ue.getRenderEvents(e.node.events):{};return w("div",{class:"cannotPreview","data-key":e.id},[w(m,M({style:e.node.style,class:"baseButton",type:e.node.buttonstyle,size:e.node.size,disabled:e.node.isDisable},n),{default:()=>[w("i",{class:["icon iconfont leftIcon",e.node.icon.leftIcon],style:{"font-size":e.node.icon.leftIconSize}},null),e.node.children?e.node.children:"渲染按钮",w("i",{class:["icon iconfont rightIcon",e.node.icon.rightIcon],style:{"font-size":e.node.icon.rightIconSize}},null)]})])},defaultData:{type:"button",style:{position:"relative",width:"87px",height:"32px",zIndex:1},buttonstyle:"",size:"default",icon:{},twiceComfire:{},bubblePrompt:{},isDisable:!1,children:"渲染按钮"}},{label:"输入框",icon:"icon iconfont icon-input",type:"input",category:"common",render(e){var t;let n=(null==(t=e.node)?void 0:t.events)&&ve.isPreview?ue.getRenderEvents(e.node.events):{};return w("div",{class:"cannotPreview","data-key":e.id},[w(me,{option:e.node,events:n},null)])},defaultData:{type:"input",value:"",inputStyle:"text",size:"default",placeholder:"请输入",showPassword:!1,clearable:!1,showWordLimit:!1,disabled:!1,readonly:!1,autofocus:!1,style:{position:"relative",zIndex:1},children:""}},{label:"下拉框",icon:"icon iconfont icon-m-xialacaidan",type:"select",category:"common",render(e){var t;let n=(null==(t=e.node)?void 0:t.events)&&ve.isPreview?ue.getRenderEvents(e.node.events):{};return w("div",{class:"cannotPreview","data-key":e.id},[w(ge,{option:e.node,events:n},null)])},defaultData:{type:"select",style:{position:"relative",zIndex:1},children:"",defaultValue:""}},{label:"文本框",icon:"icon iconfont icon-wenben",type:"textBox",category:"form",render(e){var t;let n=(null==(t=e.node)?void 0:t.events)&&ve.isPreview?ue.getRenderEvents(e.node.events):{};return w("div",{class:"cannotPreview",style:e.node.style.box,"data-key":e.id},[w(fe,{option:e.node,events:n},null)])},defaultData:{value:"",type:"textBox",title:"文本",style:{box:{display:"block"},title:{},input:{}},children:""}},{label:"多行文本框",icon:"icon iconfont icon-duohangwenben1",type:"multilineText",category:"form",render(e){var t;let n=(null==(t=e.node)?void 0:t.events)&&ve.isPreview?ue.getRenderEvents(e.node.events):{};return w("div",{class:"cannotPreview",style:e.node.style.box,"data-key":e.id},[w(he,{option:e.node,events:n},null)])},defaultData:{value:"",type:"multilineText",title:"多行文本",style:{box:{display:"block"},title:{},input:{}},children:"",autosize:{minRows:2,maxRows:6}}}];const be=new class{constructor(e=[],t=new Map,n=[]){this.componentList=e,this.componentMap=t,this.iconList=n}register(e,t=!1){t?this.iconList.push(e):this.componentList.push(e),this.componentMap.set(e.type,e)}};for(let Re of we)be.register({label:Re.label,type:Re.type,category:Re.category,defaultData:Re.defaultData,display:!0,preview:()=>w(Ce,{block:Re}),render:e=>Re.render(e)});for(let Re of ye)be.register({label:Re.label,type:"icon",category:"icon",display:!0,defaultData:{icon:Re.icon,type:"icon",style:{position:"relative",fontSize:"16px",color:"black",zIndex:1},children:""},preview:()=>w("span",{datatype:"icon",class:"iconSpan"},[w("i",{class:Re.icon},null)]),render:e=>w("div",{class:"cannotPreview","data-key":e.id},[w("i",{class:e.node.icon,style:e.node.style},null)])},!0);const Ce=v({props:{block:{type:Object}},setup:e=>()=>w("span",{datatype:e.block.type},[w("i",{class:e.block.icon},null),w("label",null,[e.block.label])])});const Ee={__name:"settingPages",props:["modifyForm"],setup(n){const o=n,l=s(e);let a=D(null),d=k({username:"",oldPassword:"",newPassword:"",checkPassword:""});const p=()=>{a.value.validate((async e=>{if(!e)return;var n;let a=(await(n=d.username,i({method:"post",url:"/modfiyUserInfo/modifyUsername",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{username:n}}))).data;a.status?c.error(a.msg):(c.success(a.msg),l.username=a.username,t("username",a.username),d.username="",o.modifyForm.value=!1,d.username="")}))};let m=D(null);const h=()=>{m.value.validate((async e=>{if(!e)return;var n;let a=(await(n=d.newPassword,i({method:"post",url:"/modfiyUserInfo/modifyPassword",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{password:n}}))).data;a.status?c.error(a.msg):(c.success(a.msg),l.password=a.password,t("password",a.password),o.modifyForm.value=!1,d.oldPassword="",d.newPassword="",d.checkPassword="")}))};let y=k({username:[{min:3,max:10,message:"用户名长度应在 3-10 个字符",trigger:"blur"},{validator:async(e,t,n)=>{if(""===t)n(new Error("请新的输入用户名"));else{let e=(await r(d.username)).data;e.status?n(new Error(e.msg)):n()}},trigger:"blur"}],oldPassword:[{validator:async(e,t,n)=>{if(""===t)n(new Error("请输入原始密码"));else{if(""!==d.oldPassword){let e=await(o=d.oldPassword,i({method:"post",url:"/modfiyUserInfo/checkPassword",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{password:o}})),t=e.data;t.status?n(new Error(t.msg)):n()}n()}var o},trigger:"blur"}],newPassword:[{min:6,max:15,message:"密码长度应在 6-15 个字符",trigger:"blur"},{validator:(e,t,n)=>{""===t?n(new Error("请输入密码")):(""!==d.checkPassword&&m.value.validateField("checkPassword"),n())},trigger:"blur"}],checkPassword:[{validator:(e,t,n)=>{""===t?n(new Error("请再次输入密码")):t!==d.newPassword?n(new Error("两次输入密码不一致!")):n()},trigger:"blur"}]});const v=()=>{m.value.resetFields(),a.value.resetFields()};return(e,t)=>{const n=b("el-tab-pane"),o=b("el-tabs");return S(),L(o,{type:"border-card","tab-position":"left",class:"card",onTabClick:v},{default:R((()=>[w(n,{label:"修改用户名"},{default:R((()=>[w(T(g),{ref_key:"usernameFormRef",ref:a,model:T(d),rules:T(y),"label-width":"100px",autocomplete:"off"},{default:R((()=>[w(T(f),{label:"用户名：",prop:"username",class:"formItemCommon"},{default:R((()=>[w(T(u),{placeholder:"请输入新的用户名",modelValue:T(d).username,"onUpdate:modelValue":t[0]||(t[0]=e=>T(d).username=e),"input-style":"height:35px;",autocomplete:"off"},null,8,["modelValue"])])),_:1}),w(T(f),{class:"btns"},{default:R((()=>[K("button",{class:"confirm",onClick:p},"立即修改")])),_:1})])),_:1},8,["model","rules"])])),_:1}),w(n,{label:"修改密码"},{default:R((()=>[w(T(g),{ref_key:"passwordFormRef",ref:m,model:T(d),rules:T(y),"label-width":"100px"},{default:R((()=>[w(T(f),{label:"原始密码：",prop:"oldPassword",class:"formItemCommon"},{default:R((()=>[w(T(u),{placeholder:"请输入原始密码",modelValue:T(d).oldPassword,"onUpdate:modelValue":t[1]||(t[1]=e=>T(d).oldPassword=e),"input-style":"height:35px;",autocomplete:"off"},null,8,["modelValue"])])),_:1}),w(T(f),{label:"修改密码：",prop:"newPassword"},{default:R((()=>[w(T(u),{placeholder:"请输入新的密码",modelValue:T(d).newPassword,"onUpdate:modelValue":t[2]||(t[2]=e=>T(d).newPassword=e),"input-style":"height:35px;","show-password":"",type:"password",autocomplete:"off"},null,8,["modelValue"])])),_:1}),w(T(f),{label:"确认密码：",prop:"checkPassword"},{default:R((()=>[w(T(u),{placeholder:"请再次输入密码",modelValue:T(d).checkPassword,"onUpdate:modelValue":t[3]||(t[3]=e=>T(d).checkPassword=e),"input-style":"height:35px;","show-password":"",type:"password"},null,8,["modelValue"])])),_:1}),w(T(f),{class:"btns"},{default:R((()=>[K("button",{class:"confirm",onClick:h},"立即修改")])),_:1})])),_:1},8,["model","rules"])])),_:1})])),_:1})}}},xe=v({setup(){const e=D(!1);return()=>w("div",{class:"setting"},[w("div",{class:"setting-user"},[w("div",{class:"setting-user-portrait"},[w("img",{src:d},null)]),w("div",{class:"setting-user-info",title:n("username")},[n("username")])]),w("div",{class:"setting-line"},null),w("div",{class:"setting-common"},[w("div",{class:"icon iconfont icon-yonghu"},null),w("div",{class:"setting-common-name",onClick:()=>{o.push("/home")}},[x("我的主页")])]),w("div",{class:"setting-common",onClick:()=>{e.value=!0}},[w("div",{class:"icon iconfont icon-xiugai"},null),w("div",{class:"setting-common-name"},[x("我的设置")])]),w(b("el-dialog"),{title:"我的设置",modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,width:"540px"},{default:()=>[w(Ee,{modifyForm:e},null)]}),w("div",{class:"setting-common setting-warn",onClick:()=>(o.push("/login"),sessionStorage.clear(),void localStorage.clear())},[w("div",{class:"icon iconfont icon-h"},null),w("div",{class:"setting-common-name"},[x("退出登录")])])])}});let De=l(e);const Pe=e=>{let t=De.EditorDataMap.get(e);if(t.children instanceof Array)return t.children.map((e=>{var t;let n=Pe(e),o=De.EditorDataMap.get(e),l=k({node:o,id:e,style:o.style});return o.type.includes("container")&&(l.children=n,l.childrenList=o.children),null==(t=be.componentMap.get(o.type))?void 0:t.render(l)}))};function Me(){return i({method:"get",url:"/getEditData",headers:{"Content-Type":"application/x-www-form-urlencoded"}})}function ke(e){return i({method:"post",url:"/delEditData",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{id:e}})}function Se(e){return i({method:"post",url:"/addEditData",headers:{"Content-Type":"application/json;charset=utf-8"},data:e})}function Le(e){return i({method:"post",url:"/updateEditData",headers:{"Content-Type":"application/json;charset=utf-8"},data:e})}export{ie as B,xe as P,be as a,ae as b,$ as c,N as d,ue as e,Le as f,I as g,H as h,X as i,Y as j,W as k,G as l,Pe as m,q as n,ee as o,Z as p,te as q,ne as r,A as s,oe as t,le as u,Me as v,ke as w,Se as x};
